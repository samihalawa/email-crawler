<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoClient AI - Revolutionize Your Email Marketing with AI</title>
    <meta name="description" content="Streamline your marketing with AutoClient AI. Discover potential clients and engage with custom, AI-crafted emails.">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        .modal-overlay {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div id="content" class="container mx-auto px-4 py-8">
        <div class="max-w-md mx-auto">
            <h1 class="text-3xl font-bold text-center mb-6">AutoClient AI</h1>
            <h2>Find and engage potential clients with personalized, AI-generated emails.！</h2>
            <form id="searchForm" class="mb-6">
                <input type="text" id="searchTerm" placeholder="输入搜索词" class="w-full px-4 py-2 mb-4 rounded-lg shadow-md focus:outline-none focus:ring focus:ring-blue-400">
                <button type="submit" class="block w-full px-4 py-2 bg-blue-500 text-white rounded-lg shadow-md hover:bg-blue-600 focus:outline-none focus:ring focus:ring-blue-400">开始搜索</button>
            </form>
            <button id="showModal" class="block w-full px-4 py-2 bg-yellow-500 text-white rounded-lg shadow-md hover:bg-yellow-600 focus:outline-none focus:ring focus:ring-yellow-400 mt-4">显示结果</button>
            <div id="results" class="mt-8"></div>
            <div id="modal" class="fixed top-0 left-0 w-full h-full bg-gray-800 bg-opacity-50 hidden">
                <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white p-8 rounded-lg shadow-md max-w-lg overflow-auto">
            <h2 class="text-xl font-bold mb-4">Search Results</h2>
                    <table class="w-full">
                        <thead>
                                                <tr>
                                                    <th class="px-4 py-2 border">Search Term</th>
                                                    <th class="px-4 py-2 border">Email</th>
                                                    <th class="px-4 py-2 border">Page Title</th>
                                                    <th class="px-4 py-2 border">URL</th>
                                                    <th class="px-4 py-2 border">Copy</th>
                                                </tr>
                                            </thead>
                        <tbody id="modalContent"></tbody>
                    </table>
                    <div class="flex justify-end mt-4">
                        <button id="downloadCSV" class="px-4 py-2 bg-blue-500 text-white rounded-lg shadow-md hover:bg-blue-600 focus:outline-none focus:ring focus:ring-blue-400 mr-4">下载 Emails</button>
                        <button id="closeModal" class="px-4 py-2 bg-blue-500 text-white rounded-lg shadow-md hover:bg-blue-600 focus:outline-none focus:ring focus:ring-blue-400">关闭</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="/static/main.js"></script>
    <script>
    $(document).ready(function() {
        var socket;
        if (window.location.protocol === "https:") {
            socket = io.connect('https://' + document.domain + ':' + location.port);
        } else {
            socket = io.connect('http://' + document.domain + ':' + location.port);
        }
    
        $('#searchForm').submit(function(event) {
            event.preventDefault();
            var searchQuery = $('#searchTerm').val();
            socket.emit('start_search', {search_query: searchQuery});
        });
    
        socket.on('new_email', function(data) {
            // Append new email data to the table
            var newRow = $('<tr>')
                .append($('<td>').text(data.search_query))
                .append($('<td>').text(data.email))
                .append($('<td>').text(data.page_title))
                .append($('<td>').text(data.url))
                .append($('<td>').append($('<button>').text('Copy').click(function() {
                    navigator.clipboard.writeText(data.email);
                })));
            $('#modalContent').append(newRow);
        });
    
        $('#showModal').click(function() {
            $('#modal').show();
        });
    
        $('#closeModal, .modal-close').click(function() {
            $('#modal').hide();
        });
    
        $('#downloadCSV').click(function() {
        var csvContent = "data:text/csv;charset=utf-8,Search Term,Email,Page Title,URL\n";
        $('#modalContent tr').each(function() {
            $(this).find('td:not(:last)').each(function() {
                csvContent += $(this).text() + ",";
            });
            csvContent = csvContent.slice(0, -1); // Remove last comma
            csvContent += "\n";
        });
        var encodedUri = encodeURI(csvContent);
        var link = document.createElement('a');
        link.setAttribute('href', encodedUri);
        link.setAttribute('download', 'emails.csv');
        document.body.appendChild(link); // Required for FF
        link.click();
        document.body.removeChild(link);
    });
});
    </script>
</body>
</html>
