/*! FinalScout Developers Team 2024-02-05 9:05 */

const Config={plugin_type:"plugin_online",is_prd:!0,server_base_path:"https://finalscout.com",APIs:{url_finder:"/plugin/r/find/linkedin",batch_finder:"/plugin/r/scrape/linkedin",prospect_search:"/plugin/r/prospect",scrape_content_authors:"/plugin/r/scrape/content_authors",scrape_post_reactors:"/plugin/r/scrape/post_reactors",single_finder:"/api/plugin/find/email",single_finder_poll_result:"/api/plugin/find/email/status",tags:"/api/plugin/tags",setting_contact_tags:"/api/plugin/contact/tags",event_finder:"/plugin/r/scrape/event",plugin_config:"/api/plugin/config",verify_account:"/api/account/verify",report:"/api/plugin/report",notifications:"/api/plugin/notifications",login:"/account/signin",profile:"/account/profile",view_credits_usage:"/app/account/credits/usage",active_free_trial:"/account/bind/payment",buy_credits:"/credits",upgrade:"/plans",user_profile:"/api/plugin/account/profile"},popup:{app:"/app",find_professional:"/app/find/professional",find_author:"/app/find/author",find_linkedin:"/app/find/linkedin",prospect:"/app/prospect",contacts:"/app/contacts",email_types_setting:"/app/email-types",create_scrape_task:"/plugin/r/popup/create-scrape-task"},request_bg_types:{batch_scrape:"finalscout:batch:req",single_find:"finalscout:single:req",single_find_poll_status:"finalscout:single:poll_status:req",scrape_content_authors:"finalscout:scrape_content_authors:req",post_scrape_reactors:"finalscout:scrape_post_reactors:req",plugin_config:"finalscout:config:req",plugin_config_dev_setting:"finalscout:config:dev:setting",error_report:"finalscout:report:req",open_url:"finalscout:open:url",verify_account:"finalscout:verify:account:req",li_credentials:"finalscout:credentials:req",user_auth:"finalscout:user_auth:req",all_tags:"finalscout:all_tags:req",setting_contact_tags:"finalscout:setting_contact_tags:req",notifications:"finalscout:notifications:req",notification_closed:"finalscout:notifications:on_closed",save_user_settings:"finalscout:save_user_settings:req",get_user_settings:"finalscout:get_user_settings:req"},opener_commands:{plugin_version:"fs:cmd:plugin:version",plugin_url_changed:"fs:cmd:plugin:url_changed",plugin_html:"fs:cmd:plugin:html",plugin_profile_not_support:"fs:cmd:plugin:profile_not_supported",plugin_opener_click:"fs:cmd:plugin:opener_click",plugin_app_opened:"fs:cmd:plugin_app:opened",plugin_app_ready:"fs:cmd:plugin_app:ready",plugin_app_waiting_auth:"fs:cmd:plugin_app:waiting_auth",plugin_app_email_ai:"fs:cmd:plugin_app:email_ai",plugin_app_delete_contact:"fs:cmd:plugin_app:delete_contact",plugin_app_credentials:"fs:cmd:plugin_app:credentials",plugin_refresh_context:"fs:cmd:plugin_app:refresh_context",plugin_person_is_saved_contact:"fs:cmd:plugin_app:person:saved_contact",plugin_person_updated:"fs:cmd:plugin_app:person:updated",plugin_person_get_email:"fs:cmd:plugin_app:person:get_email",plugin_person_email_ai:"fs:cmd:plugin_app:person:email_ai",create_batch_task:"fs:cmd:task:batch",size_minimize:"fs:cmd:size:minimize",size_maximize:"fs:cmd:size:maximize",size_normal:"fs:cmd:size:normal",size_custom:"fs:cmd:size:custom"},messages:{find_email:["Finding email...","Searching across the web...","Searching on Twitter...","Searching on Linkedin...","Verifying email...","Domain validation...","MX record detection...","SMTP connection test...","Accept-All email verification...","Email delivery scoring...","Taking longer than expected...","Will notify you once complete..."],failed_request:"Failed to request.",sales_navigator_required:"⚠️ Using regular search instead of Sales Navigator will yield significantly less emails. Are you sure?\n\nClick Ok to open Sales Navigator.",login_required:"You need to sign in to FinalScout to continue.",tooltip_setting_tags:"Manage tags",tooltip_contact_detail:"View details in Contacts",tooltip_copy_email:"Copy email",tooltip_send_email:"Write personalized email using AI",tooltip_scrape_post_reactors:"Find emails for the post author and people reacted to the post"},cookie:{li_at:"li_at",li_a:"li_a",extra:[{name:"sid",key:"JSESSIONID"}]},extension_store_url:"",not_found_detail_url:"https://finalscout.tawk.help/article/top-reasons-for-email-not-found",step_message_timer:{min:30,max:50},waiting_load_before_find:{timer:200,max:30},inject_interval:{timer:500,max:30},poll_find_email_status:{interval:5,max_retry_count:15},opener:{app:"/plugin_app",drag_min_top:15,init_top:150,window_right:15,window_top:55,url_change_msg_delay:800,iframe_options:{id:"fs_destination_publishing_iframe",classes:[],attributes:{isDS:"1"}},size_normal:{width:"320px",height:"640px"},size_maximize:{width:"85vw",height:"calc(100vh - 100px)"}},poll_notifications_interval:1800,toast_duration:5e3,inject_positions:{SALES_NAVIGATOR_SEARCH_BAR:"sales-navigator-search-bar",SALES_NAVIGATOR_SEARCH_ITEM:"sales-navigator-search-item",SALES_NAVIGATOR_SEARCH_PROFILE_VIEW:"sales-navigator-profile-view",SALES_NAVIGATOR_LEAD_LIST_BAR:"sales-navigator-lead-list-bar",SALES_NAVIGATOR_MY_SAVED_LIST_BAR:"sales-navigator-my-saved-list-bar",TALENT_SEARCH_BAR:"talent-search-bar",TALENT_SEARCH_ITEM:"talent-search-item",TALENT_SEARCH_PROFILE_VIEW:"talent-search-profile-view",LINKEDIN_SEARCH_PEOPLE_BAR:"linkedin-search-bar",LINKEDIN_SEARCH_CONTENT_BAR:"linkedin-search-content-bar",LINKEDIN_SEARCH_PEOPLE_ITEM:"linkedin-search-item",LINKEDIN_SEARCH_GROUP_ITEM:"linkedin-search-group-item",LINKEDIN_SEARCH_EVENT_ITEM:"linkedin-search-event-item",LINKEDIN_SEARCH_CONTENT_ITEM:"linkedin-search-content-item",LINKEDIN_PROFILE_VIEW:"linkedin-profile-view",LINKEDIN_HOME_FEED_ITEM:"linkedin-home-feed-item",LINKEDIN_PROFILE_RECENT_ACTIVITY_ITEM:"linkedin-profile-recent-activity-item",LINKEDIN_COMPANY_POST_ITEM:"linkedin-company-post-item",GROUP_DETAIL_VIEW:"group-detail-view",EVENT_DETAIL_VIEW:"event-detail-view",POST_DETAIL_VIEW:"post-detail-view",PULSE_ARTICLE_DETAIL_VIEW:"pulse-article-detail-view"},source_selector:"body>code",profile_invalid_url_keywords:["/recent-activity/","/details/","/overlay/"],inject_matched_urls:{LINKEDIN_SEARCH_PEOPLE_RESULTS:["regex:https://www.linkedin.com/search/results/people"],LINKEDIN_SEARCH_GROUP_RESULTS:["regex:https://www.linkedin.com/search/results/groups"],LINKEDIN_SEARCH_EVENT_RESULTS:["regex:https://www.linkedin.com/search/results/events"],LINKEDIN_SEARCH_CONTENT_RESULTS:["regex:https://www.linkedin.com/search/results/content"],SALES_NAVIGATOR_SEARCH_RESULTS:["regex:https://www.linkedin.com/sales/search/people"],SALES_NAVIGATOR_LEAD_LIST:["regex:https://www.linkedin.com/sales/lists/people/"],SALES_NAVIGATOR_MY_SAVED_LIST:["regex:https://www.linkedin.com/sales/search/people/list/saved-leads"],TALENT_SEARCH_RESULTS:["https://www.linkedin.com/talent/hire/","https://www.linkedin.com/talent/search"],LINKEDIN_PROFILE:["https://www.linkedin.com/in/","https://www.linkedin.com/pub/"],LINKEDIN_HOME_FEED:["regex:https://www.linkedin.com/feed(/(?=\\?|$))?(\\?.*)?$"],LINKEDIN_PROFILE_RECENT_ACTIVITY:["regex:https://www.linkedin.com/in/([^\\/?#]+)/recent-activity/"],LINKEDIN_COMPANY_POSTS:["regex:https://www.linkedin.com/(company|school)/([^\\/?#]+)/posts"],SALES_NAVIGATOR_PROFILE:["https://www.linkedin.com/sales/people/","https://www.linkedin.com/sales/lead/"],TALENT_PROFILE:["https://www.linkedin.com/talent/profile/","https://www.linkedin.com/recruiter/profile/"],GROUP_DETAIL:["https://www.linkedin.com/groups/"],EVENT_DETAIL:["https://www.linkedin.com/video/event/","https://www.linkedin.com/events/"],POST_DETAIL:["https://www.linkedin.com/posts/","https://www.linkedin.com/feed/update/urn:li:activity:","https://www.linkedin.com/feed/update/urn:li:ugcPost:"],PULSE_ARTICLE_DETAIL:["https://www.linkedin.com/pulse/"]},inject_setting:{SALES_NAVIGATOR_SEARCH_BAR:[{ver:"v1",selector:".search-nav-actions",add_class:["mini"],inject_type:"prepend",with_wrap:!0,tag_selector:"input.artdeco-typeahead__input",check_result_selector:".search-results__result-item"},{ver:"v2",selector:"div:has( > .global-typeahead)",add_class:["mini"],inject_type:"append",with_wrap:!0,tag_selector:"input.artdeco-typeahead__input",check_result_selector:".artdeco-list__item"}],SALES_NAVIGATOR_LEAD_LIST_BAR:[{ver:"v1",selector:".lists-nav .flex",add_class:["mini"],inject_type:"prepend",with_wrap:!0,tag_selector:".lists-nav__list-name",check_result_selector:".artdeco-models-table-row"}],SALES_NAVIGATOR_MY_SAVED_LIST_BAR:[{ver:"v1",selector:".search-nav--container",add_class:["mini"],inject_type:"append",with_wrap:!0,tag_selector:".search-filter-keywords-typeahead input",check_result_selector:".search-results__result-item"}],TALENT_SEARCH_BAR:[{ver:"v1",selector:".profile-list__header",add_class:["mini"],inject_type:"append",with_wrap:!0,tag_selector:".project-name__name",check_result_selector:".profile-list-item"}],LINKEDIN_SEARCH_PEOPLE_BAR:[{ver:"v1",selector:".search-reusables__filters-bar-grouping",add_class:["mini"],inject_type:"append",with_wrap:!0,tag_selector:"input.search-global-typeahead__input",check_result_selector:".reusable-search__result-container"}],LINKEDIN_SEARCH_CONTENT_BAR:[{ver:"v1",selector:".search-reusables__filters-bar-grouping",add_class:["mini"],inject_type:"append",with_wrap:!0,tag_selector:"input.search-global-typeahead__input",check_result_selector:".feed-shared-update-v2"}],SALES_NAVIGATOR_SEARCH_ITEM:[{ver:"v4",selector:".artdeco-list__item:not(:has(.deferred-area--pending))",button:{selector:".mt4 ul",add_class:[],with_wrap:!0,inject_send_email_btn:!1,inject_type:"append"},profile_selector:['a[href^="/sales/lead/"]:first','a[href*="/sales/lead/"]:first']},{ver:"v3",selector:".artdeco-list__item:not(:has(.deferred-area--pending))",button:{selector:".mt4 ul > li:last",add_class:[],inject_send_email_btn:!1,inject_type:"append"},profile_selector:['a[href^="/sales/lead/"]:first','a[href*="/sales/lead/"]:first']}],TALENT_SEARCH_ITEM:[{ver:"v1",selector:".profile-list>li:not(:has(.profile-list__occlusion-area))",button:{selector:".row-aside",add_class:[],with_wrap:!0,inject_send_email_btn:!1,inject_type:"append"},profile_selector:['a[href^="/talent/profile/"]:first','a[href*="/talent/profile/"]:first']}],LINKEDIN_SEARCH_PEOPLE_ITEM:[{ver:"v1",selector:".reusable-search__result-container:not(:has(.deferred-area--pending))",button:{selector:".entity-result__actions",add_class:[],inject_send_email_btn:!1,inject_type:"append"},ignore_selector:"div[data-chameleon-result-urn='urn:li:member:headless']",profile_selector:['a[href^="https://www.linkedin.com/in/"]:first','a[href*="/in/"]:first']}],LINKEDIN_SEARCH_GROUP_ITEM:[{ver:"v1",selector:".reusable-search__result-container:not(:has(.deferred-area--pending))",check_selector:".entity-result__title-text a",button:{selector:".entity-result__divider:has(.entity-result__summary)",add_class:[],inject_type:"append"}}],LINKEDIN_SEARCH_EVENT_ITEM:[{ver:"v1",selector:".reusable-search__result-container:not(:has(.deferred-area--pending))",check_selector:".entity-result__title-text a",button:{selector:".entity-result__insights",add_class:[],inject_type:"append"}}],LINKEDIN_HOME_FEED_ITEM:[{ver:"v1",selector:".feed-shared-update-v2:not(:has(.deferred-area--pending))",check_selector:".social-details-social-counts",button:{selector:".update-v2-social-activity",add_class:[],with_wrap:!0,inject_type:"prepend"}}],LINKEDIN_SEARCH_CONTENT_ITEM:[{ver:"v1",selector:".feed-shared-update-v2:not(:has(.deferred-area--pending))",check_selector:".social-details-social-counts",button:{selector:".update-v2-social-activity",add_class:[],with_wrap:!0,inject_type:"prepend"}}],LINKEDIN_PROFILE_RECENT_ACTIVITY_ITEM:[{ver:"v1",selector:".feed-shared-update-v2:not(:has(.deferred-area--pending))",check_selector:".social-details-social-counts",button:{selector:".update-v2-social-activity",add_class:[],with_wrap:!0,inject_type:"prepend"}}],LINKEDIN_COMPANY_POST_ITEM:[{url_matches:["regex:feedView=ads"],ver:"v1",selector:".feed-shared-update-v2:not(:has(.deferred-area--pending))",check_selector:"",button:{selector:">div:last-child",add_class:["fc-company-feed-ads"],with_wrap:!0,inject_type:"append"}},{ver:"v1",selector:".feed-shared-update-v2:not(:has(.deferred-area--pending))",check_selector:".social-details-social-counts",button:{selector:".update-v2-social-activity",add_class:[],with_wrap:!0,inject_type:"prepend"}}],TALENT_SEARCH_PROFILE_VIEW:[{ver:"v1",selector:".topcard-condensed",button:{selector:".topcard-condensed__content-top",add_class:[],with_wrap:!0,inject_send_email_btn:!0,inject_type:"append"},result:{selector:".topcard-condensed__content-top",add_class:[],inject_type:"append"},expend_buttons:[".lt-line-clamp__more"],extra_html_selectors:[".summary-card__summary",".experience-card",".personal-info"],source:!1}],SALES_NAVIGATOR_SEARCH_PROFILE_VIEW:[{ver:"v1",selector:"#profile-card-section",button:{selector:'section[class^="_header_"]',add_class:[],with_wrap:!0,inject_send_email_btn:!0,inject_type:"append"},result:{selector:'section[class^="_header_"]',add_class:[],inject_type:"append"},extra_html_selectors:["#experience-section","#about-section"],source:!1}],LINKEDIN_PROFILE_VIEW:[{ver:"v1",selector:".pv-top-card, .artdeco-card:has(img.pv-top-card-profile-picture__image), .artdeco-card:has(.pv-top-card--photo)",button:{selector:".ph5:first",add_class:[],with_wrap:!0,inject_send_email_btn:!0,inject_type:"append"},loading_selector:".scaffold-layout__main .artdeco-card.pvs-loader__profile-card",result:{selector:".ph5:first",add_class:[],inject_type:"append"},expend_buttons:[],extra_html_selectors:["section:has(> #about)","section:has(> #experience)","section:has(> #education)","section:has(> #skills)","section:has(> #languages)"],source:!1}],GROUP_DETAIL_VIEW:[{ver:"v1",selector:".artdeco-card:has(img.groups-header__logo):not(:has(.deferred-area--pending))",name_selector:".groups-entity__name",button:{selector:">.relative",add_class:[],inject_type:"append"}}],EVENT_DETAIL_VIEW:[{ver:"v2",selector:".events-top-card, #events-top-card, .events-live-top-card",name_selector:".events-live-top-card__title",has_register_selector:["a[href*='eventAttending=']",".events-navigation-container button:contains('Networking')"],button:{selector:".events-top-card__info-container, .events-live-top-card__main-content>:first-child",add_class:[],inject_type:"append"}}],POST_DETAIL_VIEW:[{ver:"v1",selector:".feed-shared-update-v2",check_selector:".social-details-social-counts",button:{selector:".update-v2-social-activity",add_class:[],with_wrap:!0,inject_type:"prepend"}}],PULSE_ARTICLE_DETAIL_VIEW:[{ver:"v1",selector:"article.reader__content",check_selector:".social-details-social-counts",button:{selector:".reader-social-bar-v2",add_class:[],with_wrap:!0,inject_type:"append"}}]}};function get_campaign_params(e){return`utm_source=chrome_extension&utm_medium=chrome_extension&utm_campaign=extension&utm_content=${e}`}function get_version(){return chrome.runtime.getManifest().version}function getVersionNum(e){return/^[1-9]\d?(\.([1-9]?\d)){2}$/.test(e)?(e=e.split(".").join(""),/^\d+$/.test(e)?parseInt(e):0):0}function updateConfig(e){for(const[t,n]of Object.entries(e||{}))["inject_positions","inject_matched_urls","inject_setting"].includes(t)?Object.assign(Config[t],n):Object.assign(Config,{[t]:n})}let message_container;console&&Config.is_prd&&(console.log=function(){},console.info=function(){},console.debug=function(){}),"object"==typeof module&&(module.exports={Config:Config,get_campaign_params:get_campaign_params,get_version:get_version,getVersionNum:getVersionNum,updateConfig:updateConfig}),console.log("[FinalScout]: Plugin start");const GROUP_DETAIL_URL_REGEX=/https:\/\/www.linkedin.com\/groups\/([0-9]+)\/?$/;let plugin_context={},profile_not_supported=!1,classes={};function generate_css_cls(){["final-scout-injected-element","final-scout-button-container","final-scout-batch-button","final-scout-single-button","final-scout-send-email-button","final-scout-post-scrape-reactors","final-scout-btn-disabled","final-scout-group-button","final-scout-event-button","final-scout-injected","final-scout-result-container","final-scout-email","risky","valid","generic-email","personal-email","final-scout-dialog-content","final-scout-dialog-regular-search-scrape-type","scrape-type-title","selected-scrape-type","recommend-scrape-type","scrape-type-linkedin","scrape-type-prospect","scrape-type-sales-navigator","final-scout-dialog-logo-primary-button","final-scout-dialog-primary-button","final-scout-dialog-default-button","final-scout-dialog-link-button","final-scout-dialog-text-link","final-scout-upgrade-button","final-scout-buy-credits-button","final-scout-active-free-trial-button","final-scout-dialog-promise-button","final-scout-dialog-change-email-button","final-scout-dialog-apply-button","final-scout-dialog-message","final-scout-notification","final-scout-text-truncate","final-scout-avatar","final-scout-linkedin-icon","final-scout-copy-icon","final-scout-contacts-icon","final-scout-tags-icon","final-scout-send-email-icon","finalscout-dropdown","finalscout-dropdown-btn","finalscout-dropdown-content","finalscout-dropdown-item","final-scout-tags-container","final-scout-tag-input","finalscout-personalized-email-dialog","final-scout-message-container","final-scout-toast","final-scout-opener-container","final-scout-opener-icon","final-scout-opener-drag-icon","final-scout-draggable","final-scout-app-iframe","final-scout-window-opened"].concat(Object.values(Config.inject_positions)).forEach(e=>{let t=[];for(let n of e.split("-"))t.push(n.charAt(0));classes[e]=`fs-${t.join("")}-${Math.random().toString(36).slice(2)}`})}function inject_css(e){Object.keys(classes).forEach(t=>{e=e.replace(new RegExp(`\\b${t}\\b`,"g"),classes[t])}),e=e.replace(/(\: )|(;\n)|}|{|(, )| /g,e=>e+" ".repeat(Math.floor(2*Math.random())+1));const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href",`data:text/css;charset=utf-8;base64,${Base64.encode(e)}`),document.head.append(t)}function createElement(e,t){const n=$(e);Array.isArray(t)||(t=[]),t.push(classes["final-scout-injected-element"]);for(const e of t)n.addClass(e);return n}function getLinkedinPeopleIdentifierFromUrl(e){if(!e)return{};try{e=decodeURI(e)}catch(e){}e=`${(e=new URL(e)).origin||""}${e.pathname}`;const t=t=>{const n=t.exec(e);if(!Array.isArray(n)||n.length<2)return;let s=n[1].split("/")[0];if(s=(s||"").trim()){if(s.startsWith("AC")&&s.length>=35){let e=s.split(",");return 1===e.length?{urn_id:s}:(e.length,{urn_id:e[0]})}try{return{public_id:decodeURIComponent(s).toLowerCase()}}catch(e){}return{public_id:s.toLowerCase()}}};let n=t(/linkedin.com\/in\/(.+)\/?/);return n||((n=t(/linkedin.com\/pub\/(.+)\/?/))?n:(n=t(/linkedin.com\/sales\/lead\/(.+)\/?/))?n:(n=t(/linkedin.com\/sales\/people\/(.+)\/?/))?n:(n=t(/linkedin.com\/talent\/people\/(.+)\/?/))?n:(n=t(/linkedin.com\/recruiter\/people\/(.+)\/?/))||{})}function stopEvtPropagation(e){return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1}function currentUrlMatched(e){const t=window.location.href;for(let n of e){if(n.startsWith("regex:")){if(new RegExp(n.substring("regex:".length),"i").test(t))return!0}if(t.startsWith(n))return!0}return!1}function isInjectSettingAllowed(e){let{url_matches:t,url_excluded:n}=e||{};if(t=Array.isArray(t)?t:[],n=Array.isArray(n)?n:[],0===t.length&&0===n.length)return!0;if(t.length){const n=currentUrlMatched(t);return n||console.log("[FinalScout]: Inject setting not allowed",e),n}const s=currentUrlMatched(n);return s&&console.log("[FinalScout]: Inject setting not allowed by url_excluded",e),s}let global_cached={};function report_error(e,t){const n=`report_error_${e}`;global_cached[n]?console.log("[FinalScout]: Reported, ignore",{cache_key:n,data:t}):(global_cached[n]=!0,request_background(Config.request_bg_types.error_report,{key:e,data:t,url:window.location.href}))}function tooltipster(e,t,n){e&&0!==e.length&&e.tooltipster(Object.assign({contentAsHTML:!0,theme:"tooltipster-shadow",maxWidth:560,content:t,interactive:!0},n||{}))}function get_email_types_setting_message(){return`A generic or personal email is returned if no work email is found. <a class="${classes["final-scout-dialog-text-link"]}" href="${Config.server_base_path}${Config.popup.email_types_setting}?${get_campaign_params("email")}" target="_blank">Change settings</a>`}function open_window(e,t){e=e.indexOf("?")>0?`${e}&${get_campaign_params(t)}`:`${e}?${get_campaign_params(t)}`,window.open(e)}function open_profile_new_tab(e,t){e=e.indexOf("?")>0?`${e}&fs_trigger_btn=${t}`:`${e}?fs_trigger_btn=${t}`,window.open(e,"_blank").focus()}function showMessageBox(e,t,n,s,i){let o={width:i||"60rem",showConfirmButton:!1,showCloseButton:!0,allowEnterKey:!1,allowOutsideClick:!1,title:e||"",html:`<div class="${classes["final-scout-dialog-content"]}">${t}</div>`};Object.assign(o,n||{}),Swal.fire(o),"function"==typeof s&&s($(Swal.getHtmlContainer()),()=>{Swal.close()})}let callbacks={};function request_background(e,t,n){if(t=t||{},Object.assign(t,{type:e}),n&&"function"==typeof n){let{callback_id:s}=t;s=s||`${e}:${(new Date).getTime()}`,callbacks[s]=n,Object.assign(t,{callback_id:s})}chrome.runtime.sendMessage(t)}chrome.runtime.onMessage.addListener(function(e,t,n){const{callback_id:s}=e;if(s||console.log("[FinalScout]: Not Expected Message data--\x3e",e),"tab:url_changed"===s){const{url:t}=e||{},{person_identifier:n}=plugin_context;let s=!1;const{inject_matched_urls:i,opener:o}=Config;if(plugin_context={url:t},currentUrlMatched(i.LINKEDIN_PROFILE)||currentUrlMatched(i.SALES_NAVIGATOR_PROFILE)||currentUrlMatched(i.TALENT_PROFILE)){const e=getLinkedinPeopleIdentifierFromUrl(t)||{};if(Object.keys(e).length&&JSON.stringify(e)===JSON.stringify(n))return;Object.assign(plugin_context,{person_identifier:e}),profile_not_supported=!1,s=!0}return profile_not_supported=!1,console.log("[FinalScout]:  current tab url changed=>",t),start_inject_buttons(),void((s||$("body").hasClass(classes["final-scout-window-opened"]))&&setTimeout(function(){send_command_to_plugin_app({type:Config.opener_commands.plugin_url_changed,data:{url:t}})},o.url_change_msg_delay||800))}if("finalscout:notifications"===s&&show_notifications(e.response),"function"==typeof callbacks[s]){(0,callbacks[s])(e),delete callbacks[s]}});let shown_notification_ids=[];function show_notifications(e){if(Array.isArray(e)&&0!==e.length)for(const t of e){let{id:e,title:n,message:s,options:i}=t||{};if(e&&shown_notification_ids.includes(e))continue;i=i||{};let o={selector:message_container,text:`<div class="title">${n}</div><div class="content">${s}</div>`,escapeMarkup:!1,duration:-1,close:!1,className:`${classes["final-scout-toast"]} ${classes["final-scout-notification"]}`,gravity:i.gravity||"top",position:i.position||"right",callback:()=>{e&&request_background(Config.request_bg_types.notification_closed,{id:e})}};i.hasOwnProperty("close")&&Object.assign(o,{close:!0===i.close}),i.hasOwnProperty("duration")&&i.duration>1e3&&Object.assign(o,{duration:i.duration}),Toastify(o).showToast(),shown_notification_ids.push(e)}}function get_injected_position(){const{inject_matched_urls:e,inject_positions:t}=Config;if(e&&t)return currentUrlMatched(e.LINKEDIN_SEARCH_PEOPLE_RESULTS)?t.LINKEDIN_SEARCH_PEOPLE_BAR:currentUrlMatched(e.LINKEDIN_SEARCH_CONTENT_RESULTS)?t.LINKEDIN_SEARCH_CONTENT_BAR:currentUrlMatched(e.SALES_NAVIGATOR_SEARCH_RESULTS)?t.SALES_NAVIGATOR_SEARCH_BAR:currentUrlMatched(e.SALES_NAVIGATOR_LEAD_LIST)?t.SALES_NAVIGATOR_LEAD_LIST_BAR:currentUrlMatched(e.SALES_NAVIGATOR_MY_SAVED_LIST)?t.SALES_NAVIGATOR_MY_SAVED_LIST_BAR:currentUrlMatched(e.TALENT_SEARCH_RESULTS)?t.TALENT_SEARCH_BAR:currentUrlMatched(e.LINKEDIN_PROFILE)?t.LINKEDIN_PROFILE_VIEW:currentUrlMatched(e.SALES_NAVIGATOR_PROFILE)?t.SALES_NAVIGATOR_SEARCH_PROFILE_VIEW:currentUrlMatched(e.TALENT_PROFILE)?t.TALENT_SEARCH_PROFILE_VIEW:currentUrlMatched(e.GROUP_DETAIL)?t.GROUP_DETAIL_VIEW:currentUrlMatched(e.EVENT_DETAIL)?t.EVENT_DETAIL_VIEW:currentUrlMatched(e.POST_DETAIL)?t.POST_DETAIL_VIEW:currentUrlMatched(e.PULSE_ARTICLE_DETAIL)?t.PULSE_ARTICLE_DETAIL_VIEW:void 0}function is_profile_url_support(){const{profile_invalid_url_keywords:e}=Config;if(!Array.isArray(e)||0===e.length)return!0;const t=window.location.href.toLowerCase();for(const n of e)if(t.indexOf(n.toLowerCase())>=0)return!1;return!0}let INTERVAL_IDS={};function inject_batch_button(){const e=Config.inject_positions||{},t=Config.inject_setting||{};let n,s;if(currentUrlMatched(Config.inject_matched_urls.LINKEDIN_SEARCH_PEOPLE_RESULTS)?(n=e.LINKEDIN_SEARCH_PEOPLE_BAR,s=t.LINKEDIN_SEARCH_PEOPLE_BAR):currentUrlMatched(Config.inject_matched_urls.LINKEDIN_SEARCH_CONTENT_RESULTS)?(n=e.LINKEDIN_SEARCH_CONTENT_BAR,s=t.LINKEDIN_SEARCH_CONTENT_BAR):currentUrlMatched(Config.inject_matched_urls.SALES_NAVIGATOR_SEARCH_RESULTS)?(n=e.SALES_NAVIGATOR_SEARCH_BAR,s=t.SALES_NAVIGATOR_SEARCH_BAR):currentUrlMatched(Config.inject_matched_urls.SALES_NAVIGATOR_LEAD_LIST)?(n=e.SALES_NAVIGATOR_LEAD_LIST_BAR,s=t.SALES_NAVIGATOR_LEAD_LIST_BAR):currentUrlMatched(Config.inject_matched_urls.SALES_NAVIGATOR_MY_SAVED_LIST)?(n=e.SALES_NAVIGATOR_MY_SAVED_LIST_BAR,s=t.SALES_NAVIGATOR_MY_SAVED_LIST_BAR):currentUrlMatched(Config.inject_matched_urls.TALENT_SEARCH_RESULTS)&&(n=e.TALENT_SEARCH_BAR,s=t.TALENT_SEARCH_BAR),n&&Object.assign(plugin_context,{inject_position:n}),!n||!Array.isArray(s))return;if($(`.${classes["final-scout-batch-button"]}`).length>0)return void console.log("[FinalScout]: batch button already injected.");if(0===(s=s.filter(e=>isInjectSettingAllowed(e))).length)return void open_plugin_app();const i="batch_button";let o=createElement("<div/>",[classes["final-scout-batch-button"]]);o.html("<span></span>"),o.on("click",function(){let t=$(this).data("final_scout")||{};if(!0===t.disabled)return void console.log("[FinalScout]: batch button click ignore->no search result.");if(t.inject_position===e.LINKEDIN_SEARCH_CONTENT_BAR)return void request_background(Config.request_bg_types.scrape_content_authors,{url:window.location.href,trigger_position:n,tag:t.tag});const s=new URLSearchParams(window.location.search);if(t.inject_position!==e.LINKEDIN_SEARCH_PEOPLE_BAR||s.has("eventAttending"))request_background(Config.request_bg_types.batch_scrape,{url:window.location.href,trigger_position:t.inject_position,tag:t.tag});else{showMessageBox("Choose scrape option",` \n                <div style="color:var(--finalscout-text-color-black-45);">LinkedIn's free search results may be very limited if you don't have many connections.<br>To reach more professionals, please try searching with LinkedIn Sales Navigator or FinalScout Prospect.</div>\n                <div style="display: flex;align-items: center;justify-content: center;margin-top: 35px;">\n                  <div class="${classes["final-scout-dialog-regular-search-scrape-type"]} ${classes["scrape-type-linkedin"]}">\n                    <div class="${classes["scrape-type-title"]}">Scrape via LinkedIn</div>\n                    <div style="font-size: 13px;">\n                      Results may be very limited.<br>No extra cost.<br>Scrape limit is 1000/task.\n                    </div>\n                  </div>\n                  <div class="${classes["final-scout-dialog-regular-search-scrape-type"]} ${classes["scrape-type-sales-navigator"]} ${classes["recommend-scrape-type"]}">\n                    <div class="${classes["scrape-type-title"]}">Scrape via Sales Navigator</div>\n                    <div style="font-size: 13px;">\n                      More filters, more results.<br>Requires a Sales Nav subscription.<br>Scrape limit is 2500/task.\n                    </div>\n                  </div>\n                  <div class="${classes["final-scout-dialog-regular-search-scrape-type"]} ${classes["scrape-type-prospect"]}">\n                    <div class="${classes["scrape-type-title"]}">Scrape via FinalScout Prospect</div>\n                    <div style="font-size: 13px;">\n                      More filters, more results.<br>Requires Prospect Credits.<br>Scrape limit is 2500/task.\n                    </div>\n                  </div>\n                </div>\n                <div style="text-align: center;margin-top: 25px;">\n                  <div class="${classes["final-scout-dialog-logo-primary-button"]} ${classes["final-scout-btn-disabled"]}">Continue to task options</div>\n                </div>\n      `,{width:"88rem"},function(e,n){const s=e.find(`.${classes["final-scout-dialog-logo-primary-button"]}`);e.find(`.${classes["final-scout-dialog-regular-search-scrape-type"]}`).click(function(){const t=$(this);let n="Continue to task options";t.hasClass(classes["scrape-type-prospect"])?n="Filter results in Prospect and scrape":t.hasClass(classes["scrape-type-sales-navigator"])&&(n="Filter results in Sales Nav and scrape"),e.find(`.${classes["final-scout-dialog-regular-search-scrape-type"]}`).removeClass(classes["selected-scrape-type"]),t.addClass(classes["selected-scrape-type"]),s.removeClass(classes["final-scout-btn-disabled"]).html(n)}),s.click(()=>{const s=e.find(`.${classes["selected-scrape-type"]}`);0!==s.length&&(n(),s.hasClass(classes["scrape-type-linkedin"])?request_background(Config.request_bg_types.batch_scrape,{url:window.location.href,trigger_position:t.inject_position,tag:t.tag}):s.hasClass(classes["scrape-type-prospect"])?request_background(Config.request_bg_types.open_url,{url:`${Config.server_base_path}${Config.APIs.prospect_search}?url=${Base64.encode(window.location.href)}`}):s.hasClass(classes["scrape-type-sales-navigator"])&&request_background(Config.request_bg_types.open_url,{url:`https://www.linkedin.com/sales/search/people?doFetchHeroCard=true&keywords=${t.tag}`}))})})}});let a=0;INTERVAL_IDS.batch_button&&(clearInterval(INTERVAL_IDS.batch_button),INTERVAL_IDS.batch_button=null);let{timer:c,max:l}=Config.inject_interval||{};l=l||30;let r=!1;INTERVAL_IDS.batch_button=setInterval(function(){a+=1;for(const e of s){const t=$(e.selector);try{if(t.length){INTERVAL_IDS.batch_button&&clearInterval(INTERVAL_IDS.batch_button),console.log("[FinalScout]: Found element (Batch Button)",n,"  inject_setting->",JSON.stringify(e));let s="";if(e.tag_selector){const t=$(e.tag_selector);t.length&&(s="input"===t.prop("tagName").toLowerCase()?t.val():t.text())}let i=[classes[n]].concat(e.add_class||[]).concat([e.ver||"v1"]),a={inject_position:n,inject_setting:e,tag:$.trim(s)};if(e.check_result_selector&&0===$(e.check_result_selector).length&&(a.disabled=!0,i.push(classes["final-scout-btn-disabled"])),o.data("final_scout",a),i.forEach(e=>{o.addClass(e)}),!0===e.with_wrap){const n=createElement("<div/>",[classes["final-scout-button-container"]]);"append"===e.inject_type?t.append(n):t.prepend(n),o.appendTo(n)}else"append"===e.inject_type?t.append(o):t.prepend(o);r=!0,update_plugin_context({injected:!0});break}}catch(e){console.error(e)}}a>l&&(INTERVAL_IDS.batch_button&&clearInterval(INTERVAL_IDS.batch_button),r||(update_plugin_context({injected:!1}),report_error(i,{error_type:"inject_error",inject_type:i})))},c||500)}function inject_search_people_result_item_buttons(){const e=Config.inject_positions||{},t=Config.inject_setting||{};let n,s;if(currentUrlMatched(Config.inject_matched_urls.LINKEDIN_SEARCH_PEOPLE_RESULTS)?(n=e.LINKEDIN_SEARCH_PEOPLE_ITEM,s=t.LINKEDIN_SEARCH_PEOPLE_ITEM):currentUrlMatched(Config.inject_matched_urls.SALES_NAVIGATOR_SEARCH_RESULTS)?(n=e.SALES_NAVIGATOR_SEARCH_ITEM,s=t.SALES_NAVIGATOR_SEARCH_ITEM):currentUrlMatched(Config.inject_matched_urls.TALENT_SEARCH_RESULTS)&&(n=e.TALENT_SEARCH_ITEM,s=t.TALENT_SEARCH_ITEM),!n||!Array.isArray(s))return;if(0===(s=s.filter(e=>isInjectSettingAllowed(e))).length)return;const i=$(`.${classes["final-scout-batch-button"]}`);$(`.${classes["final-scout-single-button"]}`).length&&i.hasClass(classes["final-scout-btn-disabled"])&&(i.data("final_scout",Object.assign(i.data("final_scout"),{disabled:!1})),i.removeClass(classes["final-scout-btn-disabled"]));const o="result_items_button";let a=!1;const c=()=>{for(const e of s)if($(`${e.selector}`).length&&$(`${e.selector}:not(.${classes["final-scout-injected"]})`).each(function(){let t=$(this);if(t.addClass(classes["final-scout-injected"]),e.ignore_selector&&t.find(e.ignore_selector).length>0)return console.log("[FinalScout]: Inject Person---\x3eIgnore item by condition",e.ignore_selector),void(a=!0);const s=t.find(e.button.selector);let i="";if(Array.isArray(e.profile_selector)){(()=>{for(const n of e.profile_selector){const e=t.find(n);if(e.length)return void(i=e.attr("href"))}})()}if(!i||0===s.length)return void t.removeClass(classes["final-scout-injected"]);i=(i=i.startsWith("http")?i:`https://www.linkedin.com${i}`).indexOf("?")>0?i.slice(0,i.indexOf("?")):i,console.log("[FinalScout]: Inject Search Items Button---\x3e",{inject_position:n,profile_url:i});let o=createElement("<div/>",[classes["final-scout-single-button"],classes[n]]);const c=[].concat(e.button.add_class||[]);c.push(e.ver||"v1"),c.forEach(e=>{o.addClass(e)}),o.click(function(e){return open_profile_new_tab(i,"get_email"),stopEvtPropagation(e)});let l=null;!0===e.button.inject_send_email_btn&&(l=createElement("<div/>",[classes["final-scout-send-email-button"],classes[n]]),c.forEach(e=>{l.addClass(e)}),l.click(function(e){return open_profile_new_tab(i,"write_email"),stopEvtPropagation(e)}));!function(){if(!t.find(`.${classes["final-scout-single-button"]}`).length)if(s.attr("fc",classes[n]),!0===e.button.with_wrap){const t=createElement("<div/>",[classes["final-scout-button-container"]]);"append"===e.button.inject_type?s.append(t):s.prepend(t),o.appendTo(t),l&&l.appendTo(t)}else"append"===e.button.inject_type?(s.append(o),l&&s.append(l)):(l&&s.prepend(l),s.prepend(o))}(),a=!0}),!0===a)break};INTERVAL_IDS[o]&&(clearInterval(INTERVAL_IDS[o]),INTERVAL_IDS[o]=null);let l=0,{timer:r,max:_}=Config.inject_interval||{};_=_||30,INTERVAL_IDS[o]=setInterval(function(){l+=1,c(),a||l%_!=0||report_error(`${o}_${n}`,{error_type:"inject_error",inject_type:o,inject_position:n,inject_setting_array:s})},r||500)}function inject_profile_buttons(){const e=Config.inject_positions||{},t=Config.inject_setting||{};let n,s;if(currentUrlMatched(Config.inject_matched_urls.LINKEDIN_PROFILE)&&is_profile_url_support()?(n=e.LINKEDIN_PROFILE_VIEW,s=t.LINKEDIN_PROFILE_VIEW):currentUrlMatched(Config.inject_matched_urls.SALES_NAVIGATOR_PROFILE)?(n=e.SALES_NAVIGATOR_SEARCH_PROFILE_VIEW,s=t.SALES_NAVIGATOR_SEARCH_PROFILE_VIEW):currentUrlMatched(Config.inject_matched_urls.TALENT_PROFILE)&&(n=e.TALENT_SEARCH_PROFILE_VIEW,s=t.TALENT_SEARCH_PROFILE_VIEW),n&&Object.assign(plugin_context,{inject_position:n}),!n||!Array.isArray(s))return;if($(`.${classes["final-scout-single-button"]}, .${classes["final-scout-email"]}`).length>0)return;if(0===(s=s.filter(e=>isInjectSettingAllowed(e))).length)return void open_plugin_app();let i=!1;const o="profile_view_button",a=()=>{if($(`.${classes["final-scout-injected"]}`).length>0)i=!0;else for(const e of s)if($(`${e.selector}`).length&&$(`${e.selector}:not(.${classes["final-scout-injected"]})`).each(function(){let t=$(this);t.addClass(classes["final-scout-injected"]);const s=t.find(e.button.selector);let i;if(e.result&&e.result.selector&&(i=t.find(e.result.selector)),0===s.length||!i||0===i.length)return void t.removeClass(classes["final-scout-injected"]);console.log("[FinalScout]: Inject Person Profile View---\x3e",n);let o=createElement("<div/>",[classes["final-scout-single-button"],classes[n]]);const a=[].concat(e.button.add_class||[]);a.push(e.ver||"v1"),a.forEach(e=>{o.addClass(e)}),o.click(function(e){return start_find_email(o,!1),stopEvtPropagation(e)});let c=null;!0===e.button.inject_send_email_btn&&(c=createElement("<div/>",[classes["final-scout-send-email-button"],classes[n]]),a.forEach(e=>{c.addClass(e)}),c.click(function(e){return start_find_email(o,!0),stopEvtPropagation(e)}));!function(){if(t.find(`.${classes["final-scout-single-button"]}`).length)return;const a=getLinkedinPeopleIdentifierFromUrl(window.location.href)||{};if(update_plugin_context({injected:!0,inject_setting:e,person_identifier:a}),send_command_to_plugin_app({type:Config.opener_commands.plugin_refresh_context}),s.attr("fc",classes[n]),o.data("final_scout",{waiting_count:0,inject_position:n,inject_setting:e,email_dom:i,send_email_button:c}),!0===e.button.with_wrap){const t=createElement("<div/>",[classes["final-scout-button-container"]]);"append"===e.button.inject_type?s.append(t):s.prepend(t),o.appendTo(t),c&&c.appendTo(t)}else"append"===e.button.inject_type?(s.append(o),c&&s.append(c)):(c&&s.prepend(c),s.prepend(o));tooltipster(o,"Get Email"),c&&tooltipster(c,Config.messages.tooltip_send_email);const l=new URLSearchParams(window.location.search);if(l){const e=l.get("fs_trigger_btn")||"";"get_email"===e&&o?!0===profile_not_supported&&o.click():"write_email"===e&&c&&c.click()}}()}),!0===i)break};let c=0,{timer:l,max:r}=Config.inject_interval||{};r=r||30,INTERVAL_IDS[o]&&(clearInterval(INTERVAL_IDS[o]),INTERVAL_IDS[o]=null),INTERVAL_IDS[o]=setInterval(function(){c+=1,a(),(i||c>r)&&INTERVAL_IDS[o]&&clearInterval(INTERVAL_IDS[o]),!i&&c>r&&(update_plugin_context({injected:!1}),report_error(`${o}_${n}`,{error_type:"inject_error",inject_type:o,inject_position:n,inject_setting_array:s}))},l||500)}function group_btn_click(e){showMessageBox("Do you have a LinkedIn Sales Navigator account?",` \n            If you have a LinkedIn Sales Navigator account, you can use it to filter the group members and then scrape with FinalScout. If not, you can use FinalScout Prospect to filter and scrape the group members.\n            <div>\n              <div style="display: inline-block;margin: 0 auto;">\n                <div style="display: flex;flex-direction: column;">\n                  <div class="${classes["final-scout-dialog-logo-primary-button"]}">Yes. Go to Sales Navigator ></div> \n                  <div class="${classes["final-scout-dialog-default-button"]}">No. Scrape with FinalScout ></div>\n                </div>\n              </div>\n            </div>\n  `,{icon:"info"},function(t,n){t.find(`.${classes["final-scout-dialog-logo-primary-button"]}`).click(()=>{n(),request_background(Config.request_bg_types.open_url,{url:`https://www.linkedin.com/sales/search/people?doFetchHeroCard=true&group=${e.id}`})}),t.find(`.${classes["final-scout-dialog-default-button"]}`).click(()=>{n();const t=`${Config.server_base_path}${Config.popup.prospect}?source=group&group=${Base64.encode(JSON.stringify([{name:encodeURIComponent(e.name)||e.id,value:e.id}]))}`;request_background(Config.request_bg_types.open_url,{url:t})})})}function inject_group_buttons(){const e=window.location.href.split("?")[0],t=Config.inject_positions||{},n=Config.inject_setting||{};let s,i,o,a;if(currentUrlMatched(Config.inject_matched_urls.LINKEDIN_SEARCH_GROUP_RESULTS))s="group_results_button",o=t.LINKEDIN_SEARCH_GROUP_ITEM,a=n.LINKEDIN_SEARCH_GROUP_ITEM;else if(currentUrlMatched(Config.inject_matched_urls.GROUP_DETAIL)){let c=GROUP_DETAIL_URL_REGEX.exec(e);c&&c.length>=2&&(i=c[1],s="group_button",o=t.GROUP_DETAIL_VIEW,a=n.GROUP_DETAIL_VIEW)}if(o&&Object.assign(plugin_context,{inject_position:o}),!s||!o||!Array.isArray(a))return;if(0===(a=a.filter(e=>isInjectSettingAllowed(e))).length)return void("group_button"===s&&open_plugin_app());let c=!1;const l=()=>{for(const e of a)if($(`${e.selector}`).length){$(`${e.selector}:not(.${classes["final-scout-injected"]})`).each(function(){let t=$(this);t.addClass(classes["final-scout-injected"]);const n=t.find(e.button.selector);if(n.length){let a={};if("group_results_button"===s){const n=t.find(e.check_selector);if(0===n.length)return void console.log("[FinalScout]: Inject Group [not pass check selector]---\x3e",o);let s=GROUP_DETAIL_URL_REGEX.exec(n.attr("href"));s&&s.length>=2&&(a.id=s[1]),a.name=(n.text()||"").trim()}else a.id=i,a.name=(t.find(e.name_selector).text()||"").trim();if(!a.id)return void console.log("[FinalScout]: Inject Group [No Group ID]---\x3e",o);console.log("[FinalScout]: Inject Group---\x3e",o);let l=createElement("<div/>");if([classes["final-scout-group-button"],classes[o]].concat(e.button.add_class||[]).concat([e.ver||"v1"]).forEach(e=>{l.addClass(e)}),n.attr("fc",classes[o]),t.find(`.${classes["final-scout-group-button"]}`).length)return void(c=!0);"append"===e.button.inject_type?n.append(l):n.prepend(l),l.click(function(e){return group_btn_click(a),stopEvtPropagation(e)}),c=!0,update_plugin_context({injected:!0})}});break}};let r=0,{timer:_,max:d}=Config.inject_interval||{};d=d||30,INTERVAL_IDS[s]&&(clearInterval(INTERVAL_IDS[s]),INTERVAL_IDS[s]=null),INTERVAL_IDS[s]=setInterval(function(){r+=1,l();let e=!1;o===t.GROUP_DETAIL_VIEW?((c||r>d)&&INTERVAL_IDS[s]&&clearInterval(INTERVAL_IDS[s]),!c&&r>d&&(e=!0)):c||r%d!=0||(e=!0),e&&("group_button"===s&&update_plugin_context({injected:!1}),report_error(`${s}_${o}`,{error_type:"inject_error",inject_type:s,inject_position:o,inject_setting_array:a}))},_||500)}function inject_event_buttons(){const e=Config.inject_positions||{},t=Config.inject_setting||{};let n,s,i;if(currentUrlMatched(Config.inject_matched_urls.LINKEDIN_SEARCH_EVENT_RESULTS)?(n="event_results_button",s=e.LINKEDIN_SEARCH_EVENT_ITEM,i=t.LINKEDIN_SEARCH_EVENT_ITEM):currentUrlMatched(Config.inject_matched_urls.EVENT_DETAIL)&&(n="event_button",s=e.EVENT_DETAIL_VIEW,i=t.EVENT_DETAIL_VIEW),s&&Object.assign(plugin_context,{inject_position:s}),!n||!s||!Array.isArray(i))return;if(0===(i=i.filter(e=>isInjectSettingAllowed(e))).length)return void("event_button"===n&&open_plugin_app());let o=!1;const a=()=>{for(const e of i)if($(`${e.selector}`).length){$(`${e.selector}:not(.${classes["final-scout-injected"]})`).each(function(){let t=$(this);t.addClass(classes["final-scout-injected"]);const i=t.find(e.button.selector);if(i.length){if("event_results_button"===n){if(0===t.find(e.check_selector).length)return void console.log("[FinalScout]: Inject Event [not pass check selector]---\x3e",s)}let a=createElement("<div/>");if([classes["final-scout-event-button"],classes[s]].concat(e.button.add_class||[]).concat([e.ver||"v1"]).forEach(e=>{a.addClass(e)}),i.attr("fc",classes[s]),t.find(`.${classes["final-scout-event-button"]}`).length)return void(o=!0);console.log("[FinalScout]: Inject Event---\x3e",s),"append"===e.button.inject_type?i.append(a):i.prepend(a);const c=new URLSearchParams(window.location.search);a.click(function(s){if(stopEvtPropagation(s),"event_results_button"===n){const n=t.find(e.check_selector).attr("href");request_background(Config.request_bg_types.open_url,{url:`${n}${n.indexOf("?")>0?"&fc_action=export":"?fc_action=export"}`})}else{let n=!1,s=window.location.href,i=(t.find(e.name_selector).text()||"").trim();if(Array.isArray(e.has_register_selector))for(const t of e.has_register_selector){const e=$(t);if(e.length){if("A"===e.prop("tagName")){const t=e.attr("href");s=t.startsWith("http")?t:`https://www.linkedin.com${t}`}n=!0;break}}else{let t=$(e.has_register_selector);if(t.length){const e=t.attr("href");s=e.startsWith("http")?e:`https://www.linkedin.com${e}`,n=!0}}if(n)request_background(Config.request_bg_types.li_credentials,{},e=>{const t=`${Config.server_base_path}${Config.APIs.event_finder}?${$.param(Object.assign({url:Base64.encode(s),event_name:Base64.encode(encodeURIComponent(i))},e.response||{}))}`;"export"===c.get("fc_action")?window.location.href=t:request_background(Config.request_bg_types.open_url,{url:t})});else{showMessageBox("Attend the event to continue",'To export emails of the event attendees, please click the "Attend" or "Register" button to attend the event first.',{icon:"info"},function(e,t){})}}return!1}),"event_button"===n&&"export"===c.get("fc_action")&&a.click(),o=!0,update_plugin_context({injected:!0})}});break}};let c=0,{timer:l,max:r}=Config.inject_interval||{};r=r||30,INTERVAL_IDS[n]&&(clearInterval(INTERVAL_IDS[n]),INTERVAL_IDS[n]=null),INTERVAL_IDS[n]=setInterval(function(){c+=1,a();let t=!1;s===e.EVENT_DETAIL_VIEW?((o||c>r)&&INTERVAL_IDS[n]&&clearInterval(INTERVAL_IDS[n]),!o&&c>r&&(t=!0)):o||c%r!=0||(t=!0),t&&("event_button"===n&&update_plugin_context({injected:!1}),report_error(`${n}_${s}`,{error_type:"inject_error",inject_type:n,inject_position:s,inject_setting_array:i}))},l||500)}function inject_post_item_buttons(){const e=Config.inject_positions||{},t=Config.inject_setting||{};let n,s;if(currentUrlMatched(Config.inject_matched_urls.LINKEDIN_SEARCH_CONTENT_RESULTS)?(n=e.LINKEDIN_SEARCH_CONTENT_ITEM,s=t.LINKEDIN_SEARCH_CONTENT_ITEM):currentUrlMatched(Config.inject_matched_urls.LINKEDIN_HOME_FEED)?(n=e.LINKEDIN_HOME_FEED_ITEM,s=t.LINKEDIN_HOME_FEED_ITEM):currentUrlMatched(Config.inject_matched_urls.LINKEDIN_PROFILE_RECENT_ACTIVITY)?(n=e.LINKEDIN_PROFILE_RECENT_ACTIVITY_ITEM,s=t.LINKEDIN_PROFILE_RECENT_ACTIVITY_ITEM):currentUrlMatched(Config.inject_matched_urls.LINKEDIN_COMPANY_POSTS)&&(n=e.LINKEDIN_COMPANY_POST_ITEM,s=t.LINKEDIN_COMPANY_POST_ITEM),!n||!Array.isArray(s))return;if(0===(s=s.filter(e=>isInjectSettingAllowed(e))).length)return;const i="post_items_button";let o=!1;const a=()=>{for(const e of s)if($(`${e.selector}`).length&&$(`${e.selector}:not(.${classes["final-scout-injected"]})`).each(function(){let t=$(this);if(t.addClass(classes["final-scout-injected"]),e.check_selector&&0===t.find(e.check_selector).length)return console.log("[FinalScout]: Inject Post---\x3eIgnore item by condition",e.check_selector),void(o=!0);const s=t.find(e.button.selector);let i=t.attr("data-urn");if(!i||0===s.length)return void console.log("[FinalScout]:  invalid item==>",{post_activity_urn:i,selector:e.button.selector});console.log("[FinalScout]: Inject Search Content Items Button---\x3e",{inject_position:n,post_activity_urn:i});let a=createElement("<div/>",[classes["final-scout-post-scrape-reactors"],classes[n]]);const c=[].concat(e.button.add_class||[]);c.push(e.ver||"v1"),c.forEach(e=>{a.addClass(e)}),a.click(function(e){return request_background(Config.request_bg_types.post_scrape_reactors,{data:{source_url:window.location.href,post_activity_urn:i},trigger_position:n}),stopEvtPropagation(e)});!function(){if(!t.find(`.${classes["final-scout-post-scrape-reactors"]}`).length){if(s.attr("fc",classes[n]),!0===e.button.with_wrap){const t=createElement("<div/>",[classes["final-scout-button-container"]]);"append"===e.button.inject_type?s.append(t):s.prepend(t),a.appendTo(t)}else"append"===e.button.inject_type?s.append(a):s.prepend(a);tooltipster(a,Config.messages.tooltip_scrape_post_reactors)}}(),o=!0}),!0===o)break};INTERVAL_IDS[i]&&(clearInterval(INTERVAL_IDS[i]),INTERVAL_IDS[i]=null);let c=0,{timer:l,max:r}=Config.inject_interval||{};r=r||30,INTERVAL_IDS[i]=setInterval(function(){c+=1,a(),o||c%r!=0||report_error(`${i}_${n}`,{error_type:"inject_error",inject_type:i,inject_position:n,inject_setting_array:s})},l||500)}function inject_post_buttons(){const e=Config.inject_positions||{},t=Config.inject_setting||{};let n,s;if(currentUrlMatched(Config.inject_matched_urls.POST_DETAIL)?(n=e.POST_DETAIL_VIEW,s=t.POST_DETAIL_VIEW):currentUrlMatched(Config.inject_matched_urls.PULSE_ARTICLE_DETAIL)&&(n=e.PULSE_ARTICLE_DETAIL_VIEW,s=t.PULSE_ARTICLE_DETAIL_VIEW),n&&Object.assign(plugin_context,{inject_position:n}),!n||!Array.isArray(s))return;if($(`.${classes["final-scout-post-scrape-reactors"]}`).length>0)return;let i=!1;const o="post_view_button",a=()=>{if($(`.${classes["final-scout-injected"]}`).length>0)i=!0;else if(0!==(s=s.filter(e=>isInjectSettingAllowed(e))).length)for(const e of s)if($(`${e.selector}`).length&&$(`${e.selector}:not(.${classes["final-scout-injected"]})`).each(function(){let t=$(this);t.addClass(classes["final-scout-injected"]);const s=t.find(e.button.selector);if(0===s.length)return void t.removeClass(classes["final-scout-injected"]);if(e.check_selector&&0===t.find(e.check_selector).length)return console.log("[FinalScout]: Inject Post---\x3eIgnore item by condition",e.check_selector),void(i=!0);console.log("[FinalScout]: Inject Post View---\x3e",n);let o=createElement("<div/>",[classes["final-scout-post-scrape-reactors"],classes[n]]);const a=[].concat(e.button.add_class||[]);a.push(e.ver||"v1"),a.forEach(e=>{o.addClass(e)}),o.click(function(e){return request_background(Config.request_bg_types.post_scrape_reactors,{data:{post_url:window.location.href},trigger_position:n}),stopEvtPropagation(e)});!function(){if(!t.find(`.${classes["final-scout-post-scrape-reactors"]}`).length){if(s.attr("fc",classes[n]),!0===e.button.with_wrap){const t=createElement("<div/>",[classes["final-scout-button-container"]]);"append"===e.button.inject_type?s.append(t):s.prepend(t),o.appendTo(t)}else"append"===e.button.inject_type?s.append(o):s.prepend(o);tooltipster(o,Config.messages.tooltip_scrape_post_reactors)}}()}),!0===i){update_plugin_context({injected:!0});break}};let c=0,{timer:l,max:r}=Config.inject_interval||{};r=r||30,INTERVAL_IDS[o]&&(clearInterval(INTERVAL_IDS[o]),INTERVAL_IDS[o]=null),INTERVAL_IDS[o]=setInterval(function(){c+=1,a(),(i||c>r)&&INTERVAL_IDS[o]&&clearInterval(INTERVAL_IDS[o]),!i&&c>r&&(update_plugin_context({injected:!1}),report_error(`${o}_${n}`,{error_type:"inject_error",inject_type:o,inject_position:n,inject_setting_array:s}))},l||500)}function random(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function name_intials(e){if(""===e.trim())return"";let t=e.split(" ");return(t.length>1?[t[0][0],t[t.length-1][0]]:[t[0][0]]).join("").toUpperCase()}function string_to_hsl_color(e){let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return`hsl(${t%360}, 55%, 55%)`}function copyToClipboard(e,t){const n=document.createElement("textarea");n.value=t,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n),n.select();try{document.execCommand("copy"),e.addClass("copied"),setTimeout(()=>{e.removeClass("copied")},3e3)}catch(e){}document.body.removeChild(n)}function render_tags(e){const t=$(`.${classes["final-scout-tags-icon"]}`);t.length&&(e=Array.isArray(e)?e:[],t.data("tags",e),e.length>0?t.html(`${e.length} ${e.length>1?"tags":"tag"}`):t.empty())}function show_toolbars(e){const t=$(`.${classes["final-scout-result-container"]}`);let{contact_id:n,full_name:s,tags:i}=e;const o=createElement("<div/>",[classes["final-scout-send-email-icon"]]);o.appendTo(t),tooltipster(o,Config.messages.tooltip_send_email),o.click(()=>{let e={contact_id:n,url:window.location.href,person_identifier:plugin_context.person_identifier};send_command_to_plugin_app({type:Config.opener_commands.plugin_app_email_ai,data:e})}),Array.isArray(i)||(i=[]);const a=createElement("<div/>",[classes["final-scout-tags-icon"]]);a.appendTo(t),a.click(()=>{request_background(Config.request_bg_types.all_tags,{},e=>{setting_contact_tags({full_name:s,id:n},a,e.response,e=>{render_tags(e),send_command_to_plugin_app({type:Config.opener_commands.plugin_person_updated,data:{Tags:e}})})})}),render_tags(i),tooltipster(a,Config.messages.tooltip_setting_tags);const c=createElement("<div/>",[classes["final-scout-contacts-icon"]]);c.appendTo(t),tooltipster(c,Config.messages.tooltip_contact_detail),c.click(()=>{open_window(`${Config.server_base_path}${Config.popup.contacts}?contact=${e.contact_id}`,"find-result")})}function create_result_container({email_dom:e,inject_position:t,inject_setting:n,extra_class:s}){let i=$(`.${classes["final-scout-result-container"]}`);if(i.length>0)return{$email_container:i,$email:i.find(`.${classes["final-scout-email"]}`)};i=createElement("<div/>",[classes["final-scout-result-container"],classes[t],n.ver||"v1"]);let o=createElement("<div/>");return s=Array.isArray(s)?s:[],[classes["final-scout-email"]].concat(s).concat(n.result.add_class||[]).concat([n.ver||"v1"]).forEach(e=>{o.addClass(e)}),"append"===n.result.inject_type?e.append(i):e.prepend(i),o.appendTo(i),{$email_container:i,$email:o}}function show_found_result(e,t){let{inject_position:n,inject_setting:s,email_dom:i,send_email_button:o}=e.data("final_scout")||{};e.remove(),o&&o.remove(),i&&i.data("finished","1");const{$email_container:a,$email:c}=create_result_container({email_dom:i,inject_position:n,inject_setting:s});c.removeClass("loading");let{email:l,email_status:r,email_type:_,email_validate_time:d}=t||{};c.text(l);let p=[];r&&"risky"===r.level?(c.addClass(classes.risky),p.push("This is a risky email and it's risky for sending.")):(c.addClass(classes.valid),p.push("Valid and safe for sending."));let u=!1;_&&_.value&&(5===_.value?(c.addClass(classes["generic-email"]),u=!0):7===_.value&&(c.addClass(classes["personal-email"]),u=!0)),d&&d.length>=10&&p.push(`Verified at: ${d.slice(0,10)}.`),p.push(`<a href="https://bounceban.com/app/verify?email=${l}&source=finalscout" target="_blank" style="margin-left: 5px; text-decoration: underline !important;">Verify again</a>`),u&&p.push(`<br>${get_email_types_setting_message()}`),tooltipster(c,p.join(" "));const f=createElement("<div/>",[classes["final-scout-copy-icon"],classes["final-scout-tooltip"]]);f.appendTo(a),f.click(()=>{copyToClipboard(f,l)}),tooltipster(f,Config.messages.tooltip_copy_email)}function find_progress(e){let{min:t,max:n}=Config.step_message_timer||{};t=t||8,n=n||20;const s=Config.messages.find_email.map(e=>({message:e,timer:100*random(t,n)}));let i=s.shift();const o=()=>{if(!(e&&e.hasClass("loading")&&i&&i.message&&i.timer))return;const{message:t,timer:n}=i;e.text(t),setTimeout(()=>{s.length&&(i=s.shift(),o())},n)};o()}function setting_contact_tags(e,t,n,s){const{full_name:i,id:o}=e;let a=t.data("tags");showMessageBox(`Choose tags for ${i}`,`\n          <p style="font-size: 13px;margin-bottom: 2.5rem;margin-top: -15px;color: #999;">Click to choose a tag. Or Enter a tag name and press Enter to create a new tag.</p>\n          <div class="${classes["final-scout-tags-container"]}">\n            <div class="fc-tags">\n              <span class="fc-selected-tags"></span>\n              <input class="${classes["final-scout-tag-input"]}">\n            </div>\n            <div style="position: relative !important;">\n              <div class="fc-all-tags"></div>\n            </div>\n          </div>\n          <div style="text-align: right !important;">\n            <div class="${classes["final-scout-dialog-primary-button"]} ${classes["final-scout-dialog-apply-button"]}">Apply</div>\n          </div>\n        `,{},(e,t)=>{const i=e.find(`.${classes["final-scout-dialog-apply-button"]}`),c=e.find(`.${classes["final-scout-tags-container"]}`);i.click(function(){i.addClass("loading"),request_background(Config.request_bg_types.setting_contact_tags,{data:{contact_id:o,tags:a}},e=>{s(e.response),t()})});const l=c.find(".fc-selected-tags"),r=e.find(`.${classes["final-scout-tag-input"]}`),_=e.find(".fc-all-tags"),d=function(){_.empty().show();const e=$.trim(r.val()).toLowerCase();let t=""===e?n:n.filter(t=>t.name.toLowerCase().indexOf(e)>=0);if(0!==(t=t.filter(e=>-1===a.findIndex(t=>t.id&&t.id===e.id||t.name.toLowerCase()===e.name.toLowerCase()))).length)for(const e of t){const t=createElement(`<div>${e.name}</div>`,["fc-tag"]);t.appendTo(_),t.click(function(){-1===a.findIndex(t=>t.id===e.id)&&(p(e),a.push(e)),d()})}else _.html('<div style="text-align: center;color: #999;">No tags</div>')};c.find(".fc-tags").click(function(){r.focus(),d()});const p=function(e){const t=createElement(`<span>${e.name}</span>`,["fc-selected-tag"]);t.appendTo(l),t.click(function(){t.remove(),e.id?a.splice(a.findIndex(t=>t.id===e.id),1):a.splice(a.findIndex(t=>t.name===e.name),1),d()})};r.on("keydown",function(e){if(13===e.which){let e=$.trim(r.val());""!==e&&0===a.filter(t=>t.name.toLowerCase()===e.toLowerCase()).length&&(p({name:e}),a.push({name:e}),r.val(""),d())}}),r.on("input",function(){d()});for(const e of a)p(e)},"60rem")}function start_find_email(e,t){let n=e.data("final_scout")||{},{inject_setting:s,waiting_count:i}=n;i=i||0;const{loading_selector:o}=s||{};let{timer:a,max:c}=Config.waiting_load_before_find||{};c=c||25,!o||0===$(o).length||i>c?do_find_email_by_single(e,t):setTimeout(()=>{e.data("final_scout",Object.assign(n,{waiting_count:i+1})),start_find_email(e,t)},a||200)}function do_find_email_by_single(e,t){if(e.hasClass("loading"))return;e.addClass("loading");const n=e.data("final_scout");if(!n||!n.inject_position||!n.email_dom)return console.log("[FinalScout]: Click Ignore: invalid data: ",n),void e.remove();send_command_to_plugin_app({type:Config.opener_commands.plugin_person_get_email,data:{state:"start"}});const s=e.data("final_scout_plugin_app_callback_id");let{inject_position:i,inject_setting:o,email_dom:a,send_email_button:c}=n;if(Array.isArray(o.expend_buttons)&&o.expend_buttons.length){let e=$(o.expend_buttons.join(", "));if(console.log("[FinalScout]: Inject Person---\x3efind expend buttons=>",o.expend_buttons.join(", "),i.length),e.length)return void setTimeout(function(){e.click(),window.scrollTo({top:0,behavior:"smooth"})},200)}let l=$(`${o.selector}`).prop("outerHTML");const{extra_html_selectors:r}=o||{};Array.isArray(r)&&r.forEach(e=>{const t=$(e);0!==t.length&&(l+=t.prop("outerHTML"))}),a.data("finished","0"),a.find(`.${classes["final-scout-email"]}, .${classes["final-scout-result-container"]}`).remove(),c&&c.hide();const{$email_container:_,$email:d}=create_result_container({email_dom:a,inject_position:i,inject_setting:o,extra_class:["loading"]});if("1"===a.data("finished"))return;find_progress(d);const p=t=>{a.data("finished","1"),d.removeClass("loading"),e.removeClass("loading"),c&&c.show();const{contact:n}=t||{};send_command_to_plugin_app({type:Config.opener_commands.plugin_person_get_email,data:{state:"finished",contact:n},callback_id:s}),n&&open_plugin_app()},u=t=>{p(t),console.log("[FinalScout]:  finalscout:single:cb","find email error==>",t);const n=t.msg||t.message;n?!0===t.is_find_failed?d.addClass("failed").html(`${n}<span class="detail"></span>`):d.addClass("error").text(n):_.remove(),!0!==t.retryable&&(e.remove(),c&&c.remove())},{interval:f,max_retry_count:g}=Config.poll_find_email_status||{};let m,h=0;const E=t=>{if("1"!==a.data("finished")){if(h>=g)return console.log("[FinalScout]:  finalscout:single:cb","Overflow max retry count"),void u(m);h++,console.log("[FinalScout]:  finalscout:single:cb",`Poll contact [${t}] find status (retry count: ${h})`),request_background(Config.request_bg_types.single_find_poll_status,{data:{contact_id:t}},n=>{const s=n.response;if(!0===s.request_error){p(s);let{error_status:e}=s;return e>400&&_.remove(),handle_request_comm_errors(s,e=>{e?d.addClass("error").text(e):d.remove()}),void u(m)}return s.is_finding?(setTimeout(function(){E(t)},1e3*f),void(m||(m=s))):s.success?(p(s),void show_found_result(e,s)):void u(s)})}};let I="";!0===o.source&&($(Config.source_selector||"body>code").each(function(){I+=$(this).prop("outerHTML")}),I=`<body>${I}</body>`);const v={trigger_position:i,inject_setting_version:o.ver||"v1",html:`<div>${l}</div>`,source:I};t&&Object.assign(v,{is_write_email:!0});const{SALES_NAVIGATOR_SEARCH_PROFILE_VIEW:b,LINKEDIN_PROFILE_VIEW:A,TALENT_SEARCH_PROFILE_VIEW:w}=Config.inject_positions||{};[b,A,w].includes(i)&&(v.url=window.location.href),request_background(Config.request_bg_types.single_find,{data:v},function(n){console.log("[FinalScout]:  finalscout:single:cb",n.response);const s=n.response;if(!0===s.request_error){p(s);let{error_status:e}=s;return e>400&&_.remove(),void handle_request_comm_errors(s,e=>{e?d.addClass("error").text(e):d.remove()})}if(s.contact_id){if(t){let e={contact_id:s.contact_id,url:window.location.href,person_identifier:plugin_context.person_identifier};send_command_to_plugin_app({type:Config.opener_commands.plugin_app_email_ai,data:e})}show_toolbars(s)}if(s.success)return p(s),void show_found_result(e,s);if(s.find_timeout&&s.contact_id){const e=s.contact_id;return console.log("[FinalScout]:  finalscout:single:cb","find email timeout==>",s),void setTimeout(function(){E(e)},1e3*f)}u(s)})}function handle_request_comm_errors(e,t){let{error_status:n,msg:s}=e;if(400!==n)if(401!==n)if(403!==n)if(405!==n)if(429!==n)if(406!==n)t&&t(s);else{const t="Resend confirmation";showMessageBox("Confirm your email",`\n            <div class="text-mute text-center">\n            We've sent a confirmation to <span style="font-weight: bold;">${e.email}</span>. <br>\n            You need to confirm your email to use all features.\n            </div>\n            <div>\n              <div class="${classes["final-scout-dialog-primary-button"]} ${classes["final-scout-dialog-promise-button"]}">${t}</div>\n              <div class="${classes["final-scout-dialog-text-link"]} ${classes["final-scout-dialog-change-email-button"]}">Change email</div>\n            </div>\n            <p class="${classes["final-scout-dialog-message"]}"></p>\n          `,{icon:"info"},(e,n)=>{const s=e.find(`.${classes["final-scout-dialog-promise-button"]}`),i=e.find(`.${classes["final-scout-dialog-message"]}`);s.click(()=>{s.hasClass("disabled")||(s.addClass("disabled"),s.addClass("loading"),request_background(Config.request_bg_types.verify_account,{},e=>{const n=e.response;if(s.removeClass("loading"),i.html(n.msg),i.addClass(!0===n.success?"success":"error"),!0===n.success){let e=60;const n=setInterval(()=>{e>1?(e-=1,s.html(`${t} (${e}s)`)):(clearInterval(n),s.html(t),s.removeClass("disabled"))},1e3)}}))}),e.find(`.${classes["final-scout-dialog-change-email-button"]}`).click(()=>{n(),open_window(`${Config.server_base_path}${Config.APIs.profile}`,"activate-account")})})}else showMessageBox("",`${s||"Too many attempts.<br>Please contact FinalScout for help."}`,{icon:"error"},(e,t)=>{});else showMessageBox("",s,{icon:"info"},(e,t)=>{});else if(!1===e.has_active_free_trial){showMessageBox("Add a payment method to activate 50 credits/mon for free!",` \n               <div>You need to add a valid payment method to activate 50 emails/month for free. </div>\n               <div>You won't be automatically upgraded unless you buy a plan manually.</div>\n               <div style="display: inline-block;margin: 0 auto;margin-top: 2em;">\n                <div style="display: flex;flex-direction: column;">\n                 <div class="${classes["final-scout-dialog-primary-button"]} ${classes["final-scout-active-free-trial-button"]}">Add card now (free)</div>\n                 <div class="${classes["final-scout-dialog-default-button"]} ${classes["final-scout-upgrade-button"]}">Buy a plan</div>\n                 <div class="${classes["final-scout-dialog-link-button"]}">Skip now</div>\n                </div>\n               </div>\n          `,{icon:"info"},(e,t)=>{e.find(`.${classes["final-scout-active-free-trial-button"]}`).click(()=>{t(),open_window(`${Config.server_base_path}${Config.APIs.active_free_trial}`,"quota-limit")}),e.find(`.${classes["final-scout-upgrade-button"]}`).click(()=>{t(),open_window(`${Config.server_base_path}${Config.APIs.upgrade}`,"quota-limit")}),e.find(`.${classes["final-scout-dialog-link-button"]}`).click(()=>{t()})})}else{showMessageBox("Upgrade your plan",` \n                ${e.msg}\n               <span class="${classes["final-scout-dialog-text-link"]}">View my account usage</span>\n               <div style="margin-top: 2em;">\n                 <div class="${classes["final-scout-dialog-primary-button"]} ${classes["final-scout-buy-credits-button"]}">Buy credits</div>\n                 <div class="${classes["final-scout-dialog-primary-button"]} ${classes["final-scout-upgrade-button"]}">Upgrade plan</div>\n               </div>\n          `,{icon:"info"},(t,n)=>{t.find(`.${classes["final-scout-buy-credits-button"]}`).click(()=>{n(),open_window(`${Config.server_base_path}${Config.APIs.buy_credits}?perm_key=${e.perm_key}`,"quota-limit")}),t.find(`.${classes["final-scout-upgrade-button"]}`).click(()=>{n(),open_window(`${Config.server_base_path}${Config.APIs.upgrade}`,"quota-limit")}),t.find(`.${classes["final-scout-dialog-text-link"]}`).click(()=>{n(),open_window(`${Config.server_base_path}${Config.APIs.view_credits_usage}`,"quota-limit")})})}else{showMessageBox("",` \n              ${Config.messages.login_required}\n              <div>\n                <div class="${classes["final-scout-dialog-primary-button"]}">Sign in to FinalScout</div>\n              </div>\n    `,{icon:"info"},(e,t)=>{e.find(`.${classes["final-scout-dialog-primary-button"]}`).click(()=>{t(),open_window(`${Config.server_base_path}${Config.APIs.login}`,"login-dialog")})})}}function appStart(){request_background(Config.request_bg_types.plugin_config,{},e=>{console.log("[FinalScout]:  get config back---\x3e",e.response);const t=e.response||{},n=$("body"),s=get_version();let i;n.data("finalscout_plugin",{version:s,version_num:getVersionNum(s),is_prd:Config.is_prd,plugin_type:Config.plugin_type});try{t.config&&updateConfig(t.config),i=t.css}catch(e){console.error("update config and css error",e)}generate_css_cls(),fetch(chrome.runtime.getURL("src/res/main.css")).then(e=>e.text()).then(e=>{inject_css(e),i&&inject_css(t.css);const n=new URLSearchParams(window.location.search);n.has("fs_plugin_base_path")&&request_background(Config.request_bg_types.plugin_config_dev_setting,{base_path:n.get("fs_plugin_base_path")}),request_background(Config.request_bg_types.get_user_settings,{},e=>{init_opener(e.response)}),start_inject_buttons(),request_background(Config.request_bg_types.notifications,{callback_id:"finalscout:notifications"},e=>{show_notifications(e.response||[])})})})}function start_inject_buttons(){console.log("[FinalScout]: start inject buttons!",INTERVAL_IDS),$(`.${classes["final-scout-injected-element"]}`).remove(),$(`.${classes["final-scout-injected"]}`).removeClass(classes["final-scout-injected"]);for(const e of Object.values(INTERVAL_IDS))e&&clearInterval(e);INTERVAL_IDS={},inject_batch_button(),inject_search_people_result_item_buttons(),inject_profile_buttons(),inject_group_buttons(),inject_event_buttons(),inject_post_item_buttons(),inject_post_buttons()}function handle_plugin_app_message({type:e,data:t,callback_id:n}){t=t||{},console.log("[FinalScout]: receive opener message=>",{type:e,data:t,callback_id:n});const{opener_commands:s,opener:i}=Config;if(e===s.plugin_app_ready)send_command_to_plugin_app({type:s.plugin_version,data:{version:get_version()}});else if(e===s.size_minimize){const e=init_plugin_app_iframe();e&&(e.css({right:`-${e.width()+i.window_right+15}px`}),$("body").removeClass(classes["final-scout-window-opened"]))}else if(e===s.plugin_profile_not_support){profile_not_supported=!0;const{trigger_email:e}=t||{};!0===e&&$(`.${classes["final-scout-single-button"]}`).click()}else if([s.size_maximize,s.size_normal,s.size_custom].includes(e)){let n,{size_maximize:o,size_normal:a}=i||{};n=e===s.size_normal?a:e===s.size_maximize?o:t;const c=init_plugin_app_iframe();c&&c.css(n||{});const{open:l}=t;!0===l&&open_plugin_app()}else if(e===s.plugin_refresh_context)send_command_to_plugin_app({type:e,callback_id:n,data:plugin_context});else if(e===s.plugin_opener_click)open_plugin_app();else if(e===s.plugin_app_delete_contact)0===$(`.${classes["final-scout-single-button"]}`).length&&(plugin_context={url:window.location.href},start_inject_buttons());else if(e===s.plugin_person_is_saved_contact){const e=$(`.${classes["final-scout-single-button"]}`);e.length&&t.email&&(show_found_result(e,t),show_toolbars(t))}else if(e===s.plugin_person_updated)t.hasOwnProperty("Tags")&&render_tags(t.Tags),t.hasOwnProperty("email")&&t.email&&$(`.${classes["final-scout-email"]}`).html(t.email);else if(e===s.create_batch_task){const{inject_position:e}=plugin_context||{},{inject_positions:n}=Config;if([n.GROUP_DETAIL_VIEW].includes(e)){const e=$(`.${classes["final-scout-group-button"]}`);if(e.length)e.click();else{let e=GROUP_DETAIL_URL_REGEX.exec(window.location.href);e&&e.length>=2&&group_btn_click({id:e[1]})}}else if([n.EVENT_DETAIL_VIEW].includes(e)){const e=$(`.${classes["final-scout-event-button"]}`);e.length?e.click():request_background(Config.request_bg_types.li_credentials,{},e=>{const t=`${Config.server_base_path}${Config.APIs.event_finder}?${$.param(Object.assign({url:Base64.encode(window.location.href)},e.response||{}))}`;request_background(Config.request_bg_types.open_url,{url:t})})}else if([n.POST_DETAIL_VIEW,n.PULSE_ARTICLE_DETAIL_VIEW].includes(e)){const t=$(`.${classes["final-scout-post-scrape-reactors"]}`);t.length?t.click():request_background(Config.request_bg_types.post_scrape_reactors,{data:{post_url:window.location.href},trigger_position:e})}else{const s=$(`.${classes["final-scout-batch-button"]}`);s.length?s.click():t.inject_position===n.LINKEDIN_SEARCH_CONTENT_BAR?request_background(Config.request_bg_types.scrape_content_authors,{url:window.location.href,trigger_position:e}):request_background(Config.request_bg_types.batch_scrape,{url:window.location.href,trigger_position:t.inject_position})}const s=init_plugin_app_iframe();s&&(s.css({right:`-${s.width()+i.window_right+15}px`}),$("body").removeClass(classes["final-scout-window-opened"]))}else if(e===s.plugin_html){let{selector:s,timer:i,max_check_count:o}=t.must_loaded_setting||{};if(!s||$(s).length>0)return void get_plugin_html({type:e,data:t,callback_id:n,must_loaded_check_timeout:!1});let a=0;i=i||200,o=o||20,console.log("[FinalScout]: waiting for [must loaded] start => ",{selector:s,timer:i,max_check_count:o});const c=()=>{if($(s).length>0||a>o)return console.log(`[FinalScout]: waiting for [must loaded] end ${a>o?"(timeout)":""}`),void get_plugin_html({type:e,data:t,callback_id:n,must_loaded_check_timeout:a>o});setTimeout(()=>{a++,console.log(`[FinalScout]: waiting for [must loaded] load (${a})`),c()},i)};c()}else if(e===s.plugin_app_waiting_auth){let t=0;const s=300,i=()=>{request_background(Config.request_bg_types.user_auth,{data:["fs_token"]},o=>{const{response:a}=o||{};a&&a.fs_token?send_command_to_plugin_app({type:e,callback_id:n,data:{token:a.fs_token}}):t>s||setTimeout(()=>{t++,i()},500)})};i()}else if(e===s.plugin_app_credentials)request_background(Config.request_bg_types.li_credentials,{},t=>{send_command_to_plugin_app({type:e,callback_id:n,data:t.response})});else if(e===s.plugin_person_get_email){const t=$(`.${classes["final-scout-single-button"]}`);t.length?(t.data("final_scout_plugin_app_callback_id",n||""),t.click()):(console.log("[FinalScout]: button not injected"),send_command_to_plugin_app({type:e,callback_id:n,data:{not_injected:!0}}))}else if(e===s.plugin_person_email_ai){const e=$(`.${classes["final-scout-send-email-button"]}`);if(e.length)$(`.${classes["final-scout-single-button"]}`).data("final_scout_plugin_app_callback_id",n||""),e.click();else{const e=$(`.${classes["final-scout-single-button"]}`);e.length?start_find_email(e,!0):console.log("[FinalScout]: button not injected")}}}function get_plugin_html({type:e,data:t,callback_id:n,must_loaded_check_timeout:s}){let{waiting_for_setting:i,selectors:o,only_check_exists:a}=t||{};Array.isArray(o)&&0!==o.length||(o=["body"]);const c=t=>{let i={must_loaded_check_timeout:s,waiting_for_check_timeout:t};if(!0===a){const t=$(o.join(", "));return Object.assign(i,{exists:t.length>0,count:t.length}),void send_command_to_plugin_app({type:e,callback_id:n,data:i})}let c="";for(const e of o)c+=$(e).prop("outerHTML");o.length>1&&(c=`<div>${c}</div>`),Object.assign(i,{html:c}),send_command_to_plugin_app({type:e,callback_id:n,data:i})};let{selector:l,timer:r,max_check_count:_}=i||{};if(!l||0===$(l).length)return void c(!1);let d=0;r=r||200,_=_||20,console.log("[FinalScout]: waiting for html loaded start => ",{selector:l,timer:r,max_check_count:_});const p=()=>{if(0===$(l).length||d>_)return console.log(`[FinalScout]: waiting for html loaded end ${d>_?"(timeout)":""}`),void c(d>_);setTimeout(()=>{d++,console.log(`[FinalScout]: waiting for html loaded (${d})`),p()},r)};p()}function update_plugin_context(e){Object.assign(plugin_context,e||{});const{opener_commands:t}=Config;send_command_to_plugin_app({type:t.plugin_refresh_context})}function send_command_to_plugin_app({type:e,data:t,callback_id:n}){const s=init_plugin_app_iframe();if(s){Object.assign(plugin_context,{url:window.location.href,version:get_version()}),plugin_context.inject_position||Object.assign(plugin_context,{inject_position:get_injected_position()});try{s.get(0).contentWindow.postMessage({type:e,callback_id:n,source:"finalscout:plugin",data:t,context:plugin_context},"*")}catch(e){console.error("[FinalScout]: failed to send msg to plugin app",e)}}}function open_plugin_app(){$("body").hasClass(classes["final-scout-window-opened"])?console.log("[FinalScout]: already opened."):$(`.${classes["final-scout-opener-container"]}`).click()}function init_opener(e){if($(`.${classes["final-scout-opener-container"]}`).length>0)return;let{init_top:t,drag_min_top:n}=Config.opener||{};const s=$("body");n=Math.max(n,0);const{opener_button_top:i}=e||{},o=`<div class="${classes["final-scout-opener-container"]}">\n                          <div class="${classes["final-scout-opener-icon"]}"></div>\n                          <div class="${classes["final-scout-opener-drag-icon"]}"></div>\n                        </div>`,a=$(o).css({top:i||`${t||150}px`});a.click(function(){const e=init_plugin_app_iframe();e&&!s.hasClass(classes["final-scout-draggable"])&&(s.addClass(classes["final-scout-window-opened"]),send_command_to_plugin_app({type:Config.opener_commands.plugin_app_opened}),e.css({right:`${Config.opener.window_right}px`}))}),a.appendTo(s),a.find(`.${classes["final-scout-opener-drag-icon"]}`).get(0).onmousedown=(e=>{stopEvtPropagation(e=e||window.event);let t=a.height();const i=e=>{let s=e.clientY-t/2;s<n&&(s=n);const i=$(window).height();return s=`${((s=Math.min(s,i-t-15))/i*100).toFixed(2)}vh`};document.onmousemove=(e=>(e=e||window.event,s.addClass(classes["final-scout-draggable"]),a.css({top:i(e)}),stopEvtPropagation(e))),document.onmouseup=(e=>{e=e||window.event,document.onmouseup=null,document.onmousemove=null;const t=i(e);return a.css({top:t}),request_background(Config.request_bg_types.save_user_settings,{setting:{opener_button_top:t}}),setTimeout(()=>{s.removeClass(classes["final-scout-draggable"])},200),stopEvtPropagation(e)})}),init_plugin_app_iframe();const c=$(`<div class="${classes["final-scout-message-container"]}"></div>`);c.appendTo(s),message_container=c.get(0)}function init_plugin_app_iframe(){let e=$(`.${classes["final-scout-app-iframe"]}`);if(e.length)return e;let{size_normal:t,app:n,iframe_options:s}=Config.opener||{},{id:i,classes:o,attributes:a}=s||{};Array.isArray(o)||(o=[]);const c=$("body");let l=Config.plugin_app_url||`${Config.server_base_path}${n||"/plugin_app"}`;return(e=$(`<iframe id="${i||"fs_plugin_app"}" class="${o.join(" ")} ${classes["final-scout-app-iframe"]}" frameborder="0" scrolling="no" src="${l}?ver=${get_version()}"></iframe>`)).attr(a||{}),e.css(t),e.appendTo(c),c.removeClass(classes["final-scout-window-opened"]),window.addEventListener("message",function(e){const{data:t}=e,{source:n}=t||{};n&&["finalscout:plugin:app"].includes(n)&&handle_plugin_app_message(t)},!1),console.log("[FinalScout]: create plugin app iframe"),e}$(document).on("click",`.${classes["final-scout-email"]}.failed>span.detail`,function(){open_window(Config.not_found_detail_url,"not-found-details")}),$(document).on("click",`.${classes["finalscout-dropdown-btn"]}`,function(){$(this).siblings(`.${classes["finalscout-dropdown-content"]}`).show()}),$(window).click(function(e){e.target&&"string"==typeof e.target&&e.target.matches(`.${classes["finalscout-dropdown-btn"]}`)||$(`.${classes["finalscout-dropdown-content"]}`).hide()}),appStart();