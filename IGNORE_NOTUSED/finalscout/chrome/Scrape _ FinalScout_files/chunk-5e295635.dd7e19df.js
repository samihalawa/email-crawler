(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e295635"],{"11ee":function(e,t,a){"use strict";a("3d22")},"159b":function(e,t,a){var i=a("da84"),r=a("fdbc"),n=a("785a"),s=a("17c2"),o=a("9112"),l=function(e){if(e&&e.forEach!==s)try{o(e,"forEach",s)}catch(t){e.forEach=s}};for(var c in r)r[c]&&l(i[c]&&i[c].prototype);l(n)},"17c2":function(e,t,a){"use strict";var i=a("b727").forEach,r=a("a640"),n=r("forEach");e.exports=n?[].forEach:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}},"311e":function(e,t,a){},3711:function(e,t,a){},"3d22":function(e,t,a){},"414c":function(e,t,a){"use strict";a("f603")},"4aa0":function(e,t,a){"use strict";a("3711")},"4ee3":function(e,t,a){"use strict";a("311e")},5444:function(e,t,a){},5530:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));a("b64b"),a("a4d3"),a("4de4"),a("e439"),a("159b"),a("dbb4");var i=a("ade3");function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function n(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}},6395:function(e,t){e.exports="data:image/png;base64,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"},8291:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"position-relative email-ai-container"},[i("div",{staticClass:"d-flex align-items-center pb-3 mb-2 border-bottom"},[i("div",{staticClass:"mr-2"},[["initialize","custom"].includes(e.emailAI.state)?e._e():[i("b-button",{staticClass:"plugin-btn mr-2",staticStyle:{"min-width":"60px"},attrs:{size:"sm",variant:"outline-primary"},on:{click:function(t){return e.back_custom()}}},[e._v(" Back ")])]],2),i("div",{staticStyle:{flex:"1"}},[i("h3",{staticClass:"text-center mb-0 text-truncate view-title",class:{"custom-view":"custom"===e.emailAI.state}},["custom"===e.emailAI.state?i("i",{staticClass:"flaticon-email"}):e._e(),e._v(" "+e._s(e.emailAI.title)+" ")])])]),e.loading?i("div",{staticClass:"text-center mt-5"},[i("div",{staticClass:"loading-spinner"})]):i("div",["initialize"===e.emailAI.state?i("Initialization"):"manage_merge_fields"===e.emailAI.state?i("ManageMergeFields"):e.is_templates_list?i("Templates"):e._e(),i("CustomEmail",{class:{"d-none":"custom"!==e.emailAI.state}})],1),e.is_writing?i("div",{staticClass:"generating-mask position-absolute w-100 h-100  d-flex justify-content-center align-items-baseline align-items-md-center pt-5 pt-md-0"},[i("b-row",{staticClass:"justify-content-md-center",staticStyle:{width:"100%"}},[i("b-col",{attrs:{sm:"12",md:"4"}},[i("div",{staticClass:"text-center spinner-container position-relative"},[i("b-progress",{staticClass:"position-absolute w-100",staticStyle:{top:"0",left:"0"},attrs:{height:"3px",striped:"",animated:"",value:e.progress_percent}}),i("div",{staticClass:"px-3 py-3"},[i("div",{staticClass:"loading-spinner"}),i("div",{staticClass:"d-flex align-items-center justify-content-center"},[i("img",{attrs:{src:a("6395"),alt:"FinalScout",width:"20"}}),i("span",{staticClass:"d-inline-block mx-1"},[e._v("Save time?")]),i("a",{staticClass:"mr-1",staticStyle:{"text-decoration":"underline"},attrs:{href:"https://support.finalscout.com/article/use-emailai-to-write-emails-in-bulk-in-the-background",target:"_blank"}},[e._v("Try bulk operation")]),i("img",{attrs:{src:a("8cbf"),alt:"FinalScout",width:"20"}})])]),e.config.is_plugin_app?e._e():i("div",{staticStyle:{"margin-top":"-10px"}},[i("b-button",{staticClass:"background-run-btn",attrs:{variant:"primary",block:""},on:{click:e.run_background}},[e._v(" Send to background ")])],1)],1)])],1)],1):e._e()])},r=[],n=a("5530"),s=a("1da1"),o=(a("7db0"),a("caad"),a("96cf"),a("2f62")),l=a("907e"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-row",[a("b-col",{attrs:{sm:"12",md:"5"}},[a("Setting")],1),a("b-col",{attrs:{sm:"12",md:"7"}},[a("Preview")],1)],1)},m=[],u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-card",{staticClass:"custom-email-card setting-card",attrs:{"no-body":""}},[a("div",{staticClass:"custom-email-card-row  border-bottom font-weight-bold"},[e._v(" Email template: ")]),a("div",{staticClass:"custom-email-card-row"},[a("b-button-group",{staticClass:"d-flex"},[a("b-button",{staticClass:"select-template-btn no-right-radius dropdown-toggle text-truncate",staticStyle:{flex:"1"},attrs:{variant:"outline-secondary"},on:{click:e.select_template}},[e._v(" "+e._s(e.current_template.name)+" ")]),a("b-dropdown",{staticClass:"template-actions",attrs:{text:"Action",variant:"outline-secondary"}},[a("b-dropdown-item",{attrs:{disabled:e.is_default_template},on:{click:e.make_as_default}},[e._v("Make the template my default")]),a("b-dropdown-item",{on:{click:e.save_as_new_template}},[e._v("Save as a new template")]),a("b-dropdown-item",{attrs:{disabled:!e.is_private_template},on:{click:e.save_template}},[e._v("Save changes to current template")]),a("b-dropdown-item",{on:{click:e.create_template}},[e._v("Create a new template from scratch")]),a("b-dropdown-item",{attrs:{disabled:!e.is_private_template},on:{click:e.delete_template}},[e._v("Delete the template")])],1)],1)],1),a("div",{staticClass:"custom-email-card-row border-bottom",staticStyle:{"padding-top":"0"}},[a("editable-text",{attrs:{is_html:"",text:e.current_template.subject,text_cls:"text-truncate",placeholder:e.$t("placeholder.ai.template_subject")},on:{on_change:e.on_subject_change}})],1),a("div",{staticClass:"custom-email-card-row pt-0 border-bottom-0"},[a("div",{ref:"main_setting_container",staticClass:"mt-3"},[e.is_edit_mode?[e.is_edit_mode?a("b-form-textarea",{ref:"edit_content",staticClass:"main-ops-view template-content-edit",attrs:{autocomplete:"off"},model:{value:e.template_content,callback:function(t){e.template_content="string"===typeof t?t.trim():t},expression:"template_content"}}):e._e(),a("div",{staticClass:"content-action-bar d-flex"},[a("b-dropdown",{staticClass:"insert_merge_fields",staticStyle:{flex:"1"},attrs:{size:"sm",text:"Insert merge field","menu-class":"w-100",variant:"outline-secondary"}},[a("b-dropdown-item",{staticClass:"text-center text-primary mt-2",on:{click:e.manage_merge_fields}},[a("i",{staticClass:"flaticon-edit"}),e._v(" Create & Edit custom merge field ")]),a("b-dropdown-divider"),a("div",{staticStyle:{"min-height":"300px","max-height":"calc(100vh - 200px)","overflow-y":"auto","overflow-x":"hidden"}},e._l(e.all_merge_fields,(function(t,i){return a("b-dropdown-item",{key:i,staticClass:"d-flex",on:{click:function(a){return e.insert_merge_field(t)}}},[a("div",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip",value:{trigger:"hover",placement:"right",boundary:"window",customClass:"tooltip-text-left",variant:t.merge_value?"":"danger",title:t.merge_value||"value missing for the merge field"},expression:"{trigger: 'hover', placement: 'right', boundary: 'window', customClass: 'tooltip-text-left', variant: merge_field.merge_value ? '' : 'danger', title: merge_field.merge_value || 'value missing for the merge field'}"}],staticClass:"d-flex"},[a("div",[e._v(e._s(t.merge_key_var))]),a("div",{staticClass:"ml-2 text-truncate",class:t.merge_value?"text-success":"text-danger"},[e._v(" "+e._s(t.merge_value||"value missing for the merge field")+" ")])])])})),1)],1),a("div",{staticClass:"d-block"},[a("b-button-group",{staticClass:"ml-2",attrs:{size:"sm"}},[a("b-button",{staticClass:"plugin-btn",attrs:{variant:"primary"},on:{click:e.apply_change}},[e._v("Apply")])],1)],1)],1)]:[a("VRuntimeTemplate",{attrs:{template:e.current_template_preview_data.content,templateProps:e.current_template_preview_data.data},on:{"update:template":function(t){return e.$set(e.current_template_preview_data,"content",t)}}}),a("div",{staticClass:"content-action-bar d-flex justify-content-between align-items-center"},[a("div",{staticClass:"d-flex align-items-center"},[a("div",{staticClass:"template-stat"},[a("i",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"flaticon-email",attrs:{title:e.$t("tooltip.ai.template_usage_count")}}),a("span",{staticClass:"ml-1 text-mute"},[e._v(e._s(e._f("formatNumber")(e.current_template.usage_count)))])]),a("div",{staticClass:"template-stat cursor-pointer ml-3",on:{click:e.vote_up_template}},[a("i",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],class:e.is_votes_up?"flaticon-like":"flaticon-thumbs",attrs:{title:e.$t("tooltip.ai.template_votes_up_count")}}),a("span",{staticClass:"ml-1 text-mute"},[e._v(e._s(e._f("formatNumber")(e.current_template.votes_up_count)))])]),a("div",{staticClass:"template-stat cursor-pointer ml-3",on:{click:e.star_template}},[a("i",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],class:e.is_starred?"flaticon-star":"flaticon-rate",attrs:{title:e.$t("tooltip.ai.template_star_up_count")}}),a("span",{staticClass:"ml-1 text-mute"},[e._v(e._s(e._f("formatNumber")(e.current_template.star_count)))])])]),a("b-button",{staticClass:"plugin-btn",attrs:{size:"sm",variant:"primary"},on:{click:function(t){e.is_edit_mode=!0}}},[a("i",{staticClass:"nav-icon flaticon-edit font-weight-bold cursor-pointer"}),e._v(" Edit template ")])],1)]],2)]),a("b-dropdown",{staticClass:"write-email-btn",attrs:{split:"",block:"",right:"",variant:"primary",boundary:"window","split-class":"border-right promise-wrap-btn","toggle-class":"toggle-btn border-left"}},[a("template",{slot:"button-content"},[a("promise-btn",{attrs:{loading:e.generating,disabled:e.is_ai_writing||e.is_edit_mode,block:"",text:"Write a new email",variant:"primary",on_click:e.start_ai_write_email},on:{"update:loading":function(t){e.generating=t}}})],1),a("b-dropdown-item",{attrs:{active:e.ai_write_mode===e.AI_Write_Mode.MANUAL},on:{click:function(t){return e.setting_ai_mode(e.AI_Write_Mode.MANUAL)}}},[e._v("Manual mode")]),a("b-dropdown-item",{attrs:{active:e.ai_write_mode===e.AI_Write_Mode.AUTO},on:{click:function(t){return e.setting_ai_mode(e.AI_Write_Mode.AUTO)}}},[e._v("Write email using default template automatically ")])],2),a("TemplateOpsDialog",{attrs:{template:e.dialog_ops_template,action:e.dialog_action},on:{"update:template":function(t){e.dialog_ops_template=t},"update:action":function(t){e.dialog_action=t}}}),a("TemplateBatchAddMissingMergeFieldsDialog",{attrs:{missing_field_keys:e.missing_field_keys,on_close:e.on_batch_add_missing_merge_field_dialog_close},on:{"update:missing_field_keys":function(t){e.missing_field_keys=t},"update:on_close":function(t){e.on_batch_add_missing_merge_field_dialog_close=t}}})],1)},_=[],d=(a("a15b"),a("d81d"),a("b0c0"),function(e,t,a){if(!t.hasOwnProperty(a)){var i=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,i)}}),p={props:{template:String,parent:Object,templateProps:{type:Object,default:function(){return{}}}},render:function(e){if(this.template){var t=this.parent||this.$parent,a=t.$data;void 0===a&&(a={});var i=t.$props;void 0===i&&(i={});var r=t.$options;void 0===r&&(r={});var n=r.components;void 0===n&&(n={});var s=r.computed;void 0===s&&(s={});var o=r.methods;void 0===o&&(o={});var l=this.$data;void 0===l&&(l={});var c=this.$props;void 0===c&&(c={});var m=this.$options;void 0===m&&(m={});var u=m.methods;void 0===u&&(u={});var _=m.computed;void 0===_&&(_={});var p=m.components;void 0===p&&(p={});var A={$data:{},$props:{},$options:{},components:{},computed:{},methods:{}};Object.keys(a).forEach((function(e){void 0===l[e]&&(A.$data[e]=a[e])})),Object.keys(i).forEach((function(e){void 0===c[e]&&(A.$props[e]=i[e])})),Object.keys(o).forEach((function(e){void 0===u[e]&&(A.methods[e]=o[e])})),Object.keys(s).forEach((function(e){void 0===_[e]&&(A.computed[e]=s[e])})),Object.keys(n).forEach((function(e){void 0===p[e]&&(A.components[e]=n[e])}));var f=Object.keys(A.methods||{}),g=Object.keys(A.$data||{}),v=Object.keys(A.$props||{}),b=Object.keys(this.templateProps),h=g.concat(v).concat(f).concat(b),w=(k=t,x={},f.forEach((function(e){return d(k,x,e)})),x),y=function(e){var t={};return e.forEach((function(e){e&&Object.getOwnPropertyNames(e).forEach((function(a){return d(e,t,a)}))})),t}([A.$data,A.$props,w,this.templateProps]);return e({template:this.template||"<div></div>",props:h,computed:A.computed,components:A.components,provide:this.$parent._provided},{props:y})}var k,x}},A=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-modal",{attrs:{id:"template_ops_modal","no-close-on-backdrop":"","content-class":"shadow","body-class":"p-0",centered:e.config.is_plugin_app,size:"lg",title:e.title},scopedSlots:e._u([{key:"modal-footer",fn:function(t){var i=t.hide;return[a("b-button",{staticClass:"plugin-btn mr-4",attrs:{variant:"outline-primary"},on:{click:function(e){return i()}}},[e._v(" Back ")]),a("promise-btn",{attrs:{cls:"plugin-btn",text:e.apply_btn_text,variant:"primary",on_click:e.apply}})]}}])},[a("vue-perfect-scrollbar",{staticClass:"modal-scrollable-content",staticStyle:{padding:"1rem"},attrs:{settings:{suppressScrollX:!0,wheelPropagation:!1}}},[a("b-form",{staticClass:"mb-3"},[a("b-form-group",{attrs:{label:"Template name:","label-for":"input_template_name"}},[a("b-form-input",{attrs:{id:"input_template_name",state:e.validate_template_name,maxlength:"256",placeholder:"",type:"text"},model:{value:e.ops_template.name,callback:function(t){e.$set(e.ops_template,"name","string"===typeof t?t.trim():t)},expression:"ops_template.name"}})],1),a("b-form-group",{attrs:{label:"Description:","label-for":"input_template_desc"}},[a("b-form-textarea",{attrs:{id:"input_template_desc",state:e.validate_template_desc,maxlength:"350",rows:"3"},model:{value:e.ops_template.desc,callback:function(t){e.$set(e.ops_template,"desc","string"===typeof t?t.trim():t)},expression:"ops_template.desc"}})],1),a("tag-input",{attrs:{label:"Tags",tag_type:"template_tags",selected_tags:e.template.Tags,on_change:e.on_tags_change},on:{"update:selected_tags":function(t){return e.$set(e.template,"Tags",t)}}}),a("b-row",[a("b-col",{attrs:{md:"6",sm:"12"}},[a("div",{staticClass:"my-2 d-flex form-group align-items-center  justify-content-between"},[a("label",{staticClass:"mr-3 my-0",attrs:{for:"cb_is_default"}},[e._v("Make the template my default:")]),a("b-form-checkbox",{attrs:{id:"cb_is_default",name:"check-button",switch:""},model:{value:e.is_default,callback:function(t){e.is_default=t},expression:"is_default"}})],1)])],1),a("b-row",[a("b-col",{attrs:{md:"6",sm:"12"}},[a("div",{staticClass:"my-2 d-flex form-group  align-items-center justify-content-between"},[a("label",{staticClass:"mr-3 my-0",attrs:{for:"cb_is_public"}},[e._v("Make the template public:")]),a("b-form-checkbox",{attrs:{id:"cb_is_public",name:"check-button",switch:""},model:{value:e.ops_template.is_public,callback:function(t){e.$set(e.ops_template,"is_public",t)},expression:"ops_template.is_public"}})],1)])],1),a("b-alert",{staticClass:"rounded-0 py-2 mt-3 mb-0",attrs:{show:"",variant:"warning"}},[e._v(" Make your template public and earn 1 email credit for every 10 emails generated using your template "),a("a",{attrs:{href:"https://support.finalscout.com/article/get-free-email-credits-from-my-public-emailai-templates",target:"_blank"}},[e._v("[Rules]")])]),e.ops_template.is_public?a("div",[a("div",{staticClass:"mt-2"},[e._v("Enter information to display publicly along with your template "),a("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:e.$t("tooltip.ai.user_display_name")}},[e._v("[?]")])]),a("b-row",[a("b-col",{attrs:{md:"6",sm:"12"}},[a("b-form-input",{staticClass:"mt-2",attrs:{maxlength:"60",placeholder:"My name",type:"text"},model:{value:e.user_display_name,callback:function(t){e.user_display_name="string"===typeof t?t.trim():t},expression:"user_display_name"}})],1),a("b-col",{attrs:{md:"6",sm:"12"}},[a("b-form-input",{staticClass:"mt-2",attrs:{state:e.validate_user_website,placeholder:"URL (my twitter, website, Linkedin, etc.)",maxlength:"256",type:"text"},model:{value:e.user_website,callback:function(t){e.user_website="string"===typeof t?t.trim():t},expression:"user_website"}})],1)],1)],1):e._e()],1)],1)],1)},f=[],g=(a("498a"),{props:{action:{type:String,default:"save"},template:{type:Object,default:{Tags:[]}}},watch:{template:{handler:function(){this.ops_template=Object.assign({},this.template),this.is_default=this.ops_template.id===this.email_ai_setting.default_tpl_id},immediate:!0},"user.email_ai_setting.default_tpl_id":{handler:function(){this.is_default=this.ops_template.id===this.email_ai_setting.default_tpl_id},immediate:!0},"user.display_name":{handler:function(){this.user_display_name=this.user.display_name||""},immediate:!0},"user.website":{handler:function(){this.user_website=this.user.website||""},immediate:!0},action:{handler:function(){"new"===this.action&&(this.ops_template.id=null)},immediate:!0}},data:function(){return{ops_template:{Tags:[]},is_default:!1,user_display_name:"",user_website:""}},methods:{apply:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,i,r,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(""!==e.ops_template.name&&""!==e.ops_template.desc){t.next=2;break}return t.abrupt("return");case 2:if(!e.ops_template.is_public||!1!==e.validate_user_website){t.next=4;break}return t.abrupt("return");case 4:return t.prev=4,a={action:e.action,data:Object.assign(e.ops_template,{is_default:e.is_default,display_name:e.user_display_name,website:e.user_website})},t.next=8,e.$api.req({url:"/api/email-ai/email/template",method:"POST",data:a},!0);case 8:i=t.sent,r=i.user,n=i.current_template,r&&e.$store.commit("setUser",r),n&&e.$store.commit("updateCurrentTemplate",n),s="The request success.","new"===e.action&&!0===e.ops_template.is_scratch&&(s="Your new template is created. Remember to save changes to it (Action > Save changes to current template). "),e.$utils.showMessage(s),e.$bvModal.hide("template_ops_modal"),t.next=21;break;case 19:t.prev=19,t.t0=t["catch"](4);case 21:case"end":return t.stop()}}),t,null,[[4,19]])})))()},on_tags_change:function(e){this.ops_template.Tags=e}},computed:Object(n["a"])(Object(n["a"])({},Object(o["d"])({user:function(e){return e.global.user},config:function(e){return e.global.config}})),{},{email_ai_setting:function(){return this.user.email_ai_setting||{}},apply_btn_text:function(){return"save"===this.action?"Save":"Create"},title:function(){return"save"===this.action?"Edit template":"Create a new template"},validate_template_name:function(){return this.ops_template.name===this.template.name?null:this.$utils.formFieldRequired(this.ops_template.name)},validate_template_desc:function(){return this.ops_template.desc===this.template.desc?null:this.$utils.formFieldRequired(this.ops_template.desc)},validate_user_website:function(){return(""===this.user_website.trim()||!0===this.$utils.isValidURL(this.user_website))&&null}})}),v=g,b=a("2877"),h=Object(b["a"])(v,A,f,!1,null,null,null),w=h.exports,y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-modal",{attrs:{id:"template_batch_add_missing_merge_field_modal","body-class":"p-0","no-close-on-backdrop":"","content-class":"shadow","hide-header-close":"",centered:e.config.is_plugin_app,size:"lg",title:"Create required merge fields"},scopedSlots:e._u([{key:"modal-footer",fn:function(t){t.hide;return[a("promise-btn",{attrs:{cls:"plugin-btn",text:"Save all",variant:"primary",on_click:e.save_all}}),a("b-button",{staticClass:"plugin-btn ml-4",attrs:{variant:"outline-primary"},on:{click:e.skip}},[e._v(" Skip (not recommended) ")])]}}])},[a("vue-perfect-scrollbar",{staticClass:"modal-scrollable-content",staticStyle:{padding:"1rem"},attrs:{settings:{suppressScrollX:!0,wheelPropagation:!1}}},[a("p",[e._v(" The email template has some merge fields that you haven't set up yet. These are important for creating high-quality emails. A merge field is a way for a template to add personalized instruction to AI, like your recipient's name or company. These fields are not publicly shared and are specific to your email campaign. ")]),a("vue-good-table",{staticClass:"no-shadow mt-3 mb-4",attrs:{columns:e.columns,"pagination-options":{enabled:!1},styleClass:"tableOne vgt-table","select-options":{enabled:!1},rows:e.missing_merge_fields},scopedSlots:e._u([{key:"table-row",fn:function(t){return["merge_value"===t.column.field?a("span",[a("b-form-input",{ref:"merge_value_"+t.index,on:{change:function(a){e.on_change(t.index,a)}}})],1):e._e()]}}])})],1)],1)},k=[],x={props:["missing_field_keys","on_close"],watch:{missing_field_keys:{handler:function(){Array.isArray(this.missing_field_keys)&&0!==this.missing_field_keys.length?this.missing_merge_fields=this.missing_field_keys.map((function(e){return{merge_key:e,merge_key_var:"{{".concat(e,"}}"),merge_value:null}})):this.missing_merge_fields=[]},immediate:!0}},data:function(){return{missing_merge_fields:[],columns:[{label:"Merge field name",field:"merge_key_var",tdClass:"align-middle",width:"200px",sortable:!1},{label:"Merge field value",field:"merge_value",tdClass:"align-middle",sortable:!1}]}},methods:{save_all:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,i,r,n,s,o,l,c,m,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=[],i=!1,r=0,n=e.missing_merge_fields.length;case 3:if(!(r<n)){t.next=12;break}if(s=e.missing_merge_fields[r],o=s.merge_key,l=s.merge_value,""!==(l||"").trim()){t.next=8;break}return i||(e.$refs["merge_value_".concat(r)].$el.focus(),i=!0),t.abrupt("continue",9);case 8:a.push({merge_key:o,merge_value:l});case 9:r++,t.next=3;break;case 12:if(0!==a.length){t.next=14;break}return t.abrupt("return");case 14:return t.next=16,e.$api.req({url:"/api/email-ai/merge_field",method:"POST",data:a},!0);case 16:c=t.sent,m=c.success,u=c.merge_fields,m&&e.$store.commit("updateEmailAIState",{merge_fields:u}),i||(e.$bvModal.hide("template_batch_add_missing_merge_field_modal"),e.on_close&&e.on_close());case 21:case"end":return t.stop()}}),t)})))()},skip:function(){this.$bvModal.hide("template_batch_add_missing_merge_field_modal"),this.on_close&&this.on_close()},on_change:function(e,t){Object.assign(this.missing_merge_fields[e],{merge_value:t})}},computed:Object(n["a"])({},Object(o["d"])({config:function(e){return e.global.config}}))},C=x,O=Object(b["a"])(C,y,k,!1,null,null,null),j=O.exports,E=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{directives:[{name:"add-class-hover",rawName:"v-add-class-hover",value:"font-weight-bold",expression:"'font-weight-bold'"}],ref:"merge_field",class:e.text_class},[e._v(" "+e._s(e.merge_text)+" "),a("b-tooltip",{attrs:{target:function(){return e.$refs["merge_field"]},triggers:"hover",placement:"right",boundary:"window","custom-class":"custom-tooltip"},on:{shown:e.on_tooltip_shown}},[e.editable?[a("div",{staticClass:"text-center"},[a("div",{staticClass:"font-weight-bold mb-3",domProps:{innerHTML:e._s(e.title)}}),a("b-form-textarea",{ref:"input_merge_value",staticStyle:{width:"350px"},attrs:{state:e.validate_merge_value,rows:"5"},model:{value:e.merge_field_value,callback:function(t){e.merge_field_value="string"===typeof t?t.trim():t},expression:"merge_field_value"}}),a("promise-btn",{staticClass:"plugin-btn mt-3",staticStyle:{width:"100px"},attrs:{size:"sm",text:"Save",variant:"primary",on_click:e.save_merge_field}})],1)]:[e._v(" Merge field: "),a("kbd",[e._v(e._s(e.merge_key_var))])]],2)],1)},I=[],R=(a("99af"),a("0e6e")),S=a("e762"),T=S.Base64,M={components:{Template:R["a"]},props:{merge_key:{type:String,default:""},merge_value:{type:String,default:""},invalid_type:{type:String,default:""},editable:{type:Boolean,default:!1}},watch:{merge_value:{handler:function(){if(this.merge_value)try{this.merge_field_source_value=T.decode(this.merge_value),this.merge_field_value=this.merge_field_source_value}catch(e){this.merge_field_source_value="",this.merge_field_value=""}},immediate:!0}},data:function(){return{merge_field_source_value:"",merge_field_value:""}},methods:{on_tooltip_shown:function(){this.$refs["input_merge_value"]&&this.$refs["input_merge_value"].$el.focus()},save_merge_field:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,i,r,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.merge_field_value!==e.merge_field_source_value){t.next=2;break}return t.abrupt("return");case 2:if(""!==e.merge_field_value.trim()){t.next=5;break}return e.on_tooltip_shown(),t.abrupt("return");case 5:return a=[{merge_value:e.merge_field_value,merge_key:e.merge_key,force:!0}],t.next=8,e.$api.req({url:"/api/email-ai/merge_field",method:"POST",data:a},!0);case 8:i=t.sent,r=i.success,n=i.invalid_fields,s=i.merge_fields,i.saved_merge_fields,r?e.$store.commit("updateEmailAIState",{merge_fields:s}):n.merge_value&&e.on_tooltip_shown();case 14:case"end":return t.stop()}}),t)})))()}},computed:{text_class:function(){return this.merge_field_source_value?"merge-filter-text":"missing"===this.invalid_type?"text-danger":"empty"===this.invalid_type?"text-warning":""},validate_merge_value:function(){return!!this.merge_field_value&&(this.merge_field_value!==this.merge_field_source_value||null)},merge_key_var:function(){return"{{".concat(this.merge_key,"}}")},title:function(){return"".concat("missing"===this.invalid_type?"Add":"Edit"," merge field: <kbd>{{").concat(this.merge_key,"}}</kbd>")},merge_text:function(){return this.merge_field_source_value?this.merge_field_source_value:"{{".concat(this.merge_key,"}}")}}},$=M,U=(a("ed95"),Object(b["a"])($,E,I,!1,null,"38d1579e",null)),B=U.exports,P=a("b85c"),F=(a("b64b"),a("ac1f"),a("5319"),a("2532"),a("466d"),a("07ac"),a("e762")),L=F.Base64,z={name:"global",data:function(){var e=this.$utils,t=e.MailAppTypes,a=e.AI_Write_Mode;return{MailAppTypes:t,AI_Write_Mode:a}},methods:{do_start_ai_write_email:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=t.contact_email_ai,i){a.next=3;break}return a.abrupt("return");case 3:return a.next=5,i.ai_write_email({request_data:e});case 5:case"end":return a.stop()}}),a)})))()},update_setting:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$api.req({url:"/api/email-ai/update_setting",method:"POST",data:e},!0);case 3:i=a.sent,t.$store.commit("setUser",{email_ai_setting:i}),a.next=9;break;case 7:a.prev=7,a.t0=a["catch"](0);case 9:case"end":return a.stop()}}),a,null,[[0,7]])})))()},get_all_merge_data:function(){var e,t=this.all_merge_fields,a={},i=Object(P["a"])(t);try{for(i.s();!(e=i.n()).done;){var r=e.value,n=r.merge_field_name,s=r.merge_value,o=r.merge_key_var,l=r.is_ai_generated;a[n]=!0===l?o:s}}catch(c){i.e(c)}finally{i.f()}return a},get_content:function(){var e=this.current_template.content,t=this.format_template({template:e,merge_data:this.get_all_merge_data(),contact_merge_field_keys:this.contact_merge_field_keys,is_pure_text:!0}),a=t.content;return a},format_template:function(e){var t=e.template,a=e.merge_data,i=e.contact_merge_field_keys,r=e.is_pure_text;if(a=a||{},"string"!==typeof t)return{invalid_keys:[],missing_keys:[],warning_keys:[],content:"",new_merge_fields:[]};Array.isArray(i)||(i=[]);for(var n=[],s=[],o=[],l=Object.keys(a),c=t.replace(/{{(.*?)}}/g,(function(e,t){if(t=t.trim(),l.includes(t)||(t.match(/^[0-9a-zA-Z_]+$/)?s.push(t):n.push(t)),n.includes(t))return"";var c=(a[t]||"").trim();if(!0===r)return c;var m=!1;i.includes(t)||(m=!0);var u="";return c||(s.includes(t)?u="missing":(o.push(t),u="empty")),'<TemplateMergeField :editable="'.concat(m,'" merge_key="').concat(t,'" merge_value="').concat(L.encode(c),'" invalid_type="').concat(u,'"></TemplateMergeField>')})),m=[],u=0,_=s;u<_.length;u++){var d=_[u];d&&m.push({is_system:!1,merge_key:d,merge_value:"",is_edit_mode:!0})}return{content:c,invalid_keys:n,missing_keys:s,warning_keys:o,new_merge_fields:m}}},computed:Object(n["a"])(Object(n["a"])({},Object(o["d"])({user:function(e){return e.global.user},emailAI:function(e){return e.emailAI}})),{},{email_ai_setting:function(){return this.user.email_ai_setting||{}},contact_email_ai:function(){return this.emailAI.contact_email_ai},is_ai_writing:function(){return this.contact_email_ai.is_writing},ai_write_mode:function(){var e=this.email_ai_setting.write_mode;return Object.values(this.AI_Write_Mode).includes(e)?e:this.AI_Write_Mode.AUTO},mail_app:function(){var e=this.email_ai_setting.mail_app;return Object.values(this.MailAppTypes).includes(e)?e:this.MailAppTypes.SYSTEM},contact:function(){var e=this.contact_email_ai.contact;return e||{}},current_template:function(){var e=this.contact_email_ai.current_template;return e||{}},current_preview_email:function(){var e=this.contact_email_ai.current_preview_email;return e||{}},current_template_preview_data:function(){var e="",t={},a=this.current_template.content||"",i=this.format_template({template:a,merge_data:this.get_all_merge_data(),contact_merge_field_keys:this.contact_merge_field_keys}),r=i.content,n=i.invalid_keys,s=i.missing_keys,o=i.warning_keys;try{var l,c=Object(P["a"])(s);try{for(c.s();!(l=c.n()).done;){var m=l.value;t[m]="{{".concat(m,"}}")}}catch(p){c.e(p)}finally{c.f()}var u,_=Object(P["a"])(o);try{for(_.s();!(u=_.n()).done;){var d=u.value;t[d]="{{".concat(d,"}}")}}catch(p){_.e(p)}finally{_.f()}e='<div class="main-ops-view template-content">'.concat(r,"</div>")}catch(A){console.error("current_template_preview_data error->",{template_raw_content:a,content:r,invalid_keys:n,missing_keys:s,warning_keys:o},A)}return{content:e,data:t}},is_private_template:function(){var e=this.current_template.User;return e&&e.id===this.user.id},is_default_template:function(){return this.current_template.id===this.email_ai_setting.default_tpl_id},history_emails:function(){var e=this.contact_email_ai.emails;return Array.isArray(e)?e:[]},contact_merge_field_keys:function(){var e=this.emailAI.contact_merge_fields_setting;return e.map((function(e){return e.key}))},contact_merge_fields:function(){var e,t=this.emailAI.contact_merge_fields_setting,a=this.contact,i=[],r=Object(P["a"])(t);try{for(r.s();!(e=r.n()).done;){var n=e.value,s=n.key,o=n.field;i.push({merge_field_name:s,merge_key_var:"{{".concat(s,"}}"),merge_key:s,merge_value:a[o]||""})}}catch(l){r.e(l)}finally{r.f()}return i},all_merge_fields:function(){var e=this.emailAI.merge_fields;return e.concat(this.contact_merge_fields)}})},D={mixins:[z],props:{},components:{Template:R["a"],TemplateOpsDialog:w,VRuntimeTemplate:p,TemplateMergeField:B,TemplateBatchAddMissingMergeFieldsDialog:j},watch:{"emailAI.contact_email_ai.current_template":{handler:function(){this.is_edit_mode=!1,this.template_content=this.current_template.content||""},immediate:!0},"emailAI.contact_email_ai.is_ready":{handler:function(){!0===this.emailAI.contact_email_ai.is_ready&&this.ai_write_mode===this.AI_Write_Mode.AUTO&&(this.current_preview_email&&this.current_preview_email.id||this.current_template&&this.current_template.id&&this.start_ai_write_email())},immediate:!0}},data:function(){return{dialog_action:"save",dialog_ops_template:{},is_edit_mode:!1,template_content:"",generating:!1,on_batch_add_missing_merge_field_dialog_close:null,missing_field_keys:[]}},updated:function(){var e=this.$refs["edit_content"];e&&e.$el.focus()},methods:{start_ai_write_email:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.check_template({template_content:e.current_template.content,after_check_callback:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.generating=!0,a={type:"normal",template_subject:e.current_template.subject,template_content:e.current_template.content,template_merge_data:e.get_all_merge_data(),source_content:e.get_content()},t.next=4,e.do_start_ai_write_email(a);case 4:e.generating=!1;case 5:case"end":return t.stop()}}),t)})));function a(){return t.apply(this,arguments)}return a}()});case 2:case"end":return t.stop()}}),t)})))()},check_template:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,r,n,s,o,l,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=e.template_content,r=e.after_check_callback,n=t.format_template({template:i,merge_data:t.get_all_merge_data(),contact_merge_field_keys:t.contact_merge_field_keys}),s=n.invalid_keys,o=n.missing_keys,!(s.length>0)){a.next=8;break}return l="Invalid merge field key(s) detected: ".concat(s.map((function(e){return'<span class="badge badge-danger">'.concat(e,"</span>")})).join(""),". Please note that only English letters, numbers, and underscores (_) are allowed. Ensure that there are up to 48 characters and no spaces between characters when creating merge fields. For example, use <kbd>{{social_proof}}</kbd>, do NOT use <kbd>{{social proof}}</kbd>."),c={title:"",html:l,icon:"warning",width:"50rem",didDestroy:function(){},customClass:{confirmButton:"btn btn-primary"},buttonsStyling:!1},a.next=7,t.$swal(c);case 7:return a.abrupt("return");case 8:if(0!==o.length){a.next=11;break}return r&&r(),a.abrupt("return");case 11:t.missing_field_keys=o,t.on_batch_add_missing_merge_field_dialog_close=r,t.$bvModal.show("template_batch_add_missing_merge_field_modal");case 14:case"end":return a.stop()}}),a)})))()},select_template:function(){this.$store.commit("updateEmailAIState",{state:"templates_private"})},on_subject_change:function(e){var t=e.value;Object.assign(this.emailAI.contact_email_ai.current_template,{subject:t})},insert_merge_field:function(e){var t=e||{},a=t.merge_key_var,i=this.$refs["edit_content"].$el,r=i.selectionEnd,n=" ".concat(a," ");this.template_content=this.template_content.substring(0,r)+n+this.template_content.substring(r),r+=n.length,setTimeout((function(){i.setSelectionRange(r,r),i.focus()}),200)},apply_change:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.check_template({template_content:e.template_content,after_check_callback:function(){e.is_edit_mode=!1,Object.assign(e.emailAI.contact_email_ai.current_template,{content:e.template_content})}});case 1:case"end":return t.stop()}}),t)})))()},manage_merge_fields:function(e){this.$store.commit("updateEmailAIState",{state:"manage_merge_fields",manage_merge_fields_params:e||{}})},make_as_default:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.is_default_template){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.$utils.confirm({html:'Are you sure want to make the template [<span class="font-weight-bold">'.concat(e.current_template.name,"</span>] as your default?"),confirmButtonText:"Apply"});case 4:if(a=t.sent,a){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,e.update_setting({field:"default_tpl_id",value:e.current_template.id});case 9:case"end":return t.stop()}}),t)})))()},save_as_new_template:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.dialog_action="new",e.dialog_ops_template=Object.assign({},e.current_template,{is_public:!1}),e.$bvModal.show("template_ops_modal");case 3:case"end":return t.stop()}}),t)})))()},save_template:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.is_private_template){t.next=2;break}return t.abrupt("return");case 2:if(e.current_template.id){t.next=4;break}return t.abrupt("return");case 4:e.dialog_action="save",e.dialog_ops_template=Object.assign({},e.current_template),e.$bvModal.show("template_ops_modal");case 7:case"end":return t.stop()}}),t)})))()},create_template:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.dialog_action="new",e.dialog_ops_template={name:"",desc:"",subject:"",content:"",Tags:[],is_public:!1,is_default:!1,is_scratch:!0},e.$bvModal.show("template_ops_modal");case 3:case"end":return t.stop()}}),t)})))()},delete_template:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$utils.confirm({html:'Are you sure want to delete the template [<span class="font-weight-bold">'.concat(e.current_template.name,"</span>]?"),confirmButtonText:"Yes, delete it!"},{confirmButton:"btn btn-danger"});case 2:if(a=t.sent,a){t.next=5;break}return t.abrupt("return");case 5:return t.prev=5,t.next=8,e.$api.req({url:"/api/email-ai/email/template",method:"POST",data:{action:"delete",data:{id:e.current_template.id}}},!0);case 8:i=t.sent,r=i.user,e.$utils.showMessage("The template is deleted."),e.$store.commit("setUser",r),e.$store.commit("updateEmailAIState",{state:"templates_private"}),t.next=17;break;case 15:t.prev=15,t.t0=t["catch"](5);case 17:case"end":return t.stop()}}),t,null,[[5,15]])})))()},do_perform_action:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,i={action:e,data:{id:t.current_template.id}},a.next=4,t.$api.req({url:"/api/email-ai/email/template",method:"POST",data:i},!0);case 4:r=a.sent,Object.assign(t.emailAI.contact_email_ai.current_template,r),a.next=10;break;case 8:a.prev=8,a.t0=a["catch"](0);case 10:case"end":return a.stop()}}),a,null,[[0,8]])})))()},star_template:function(){this.do_perform_action("star")},vote_up_template:function(){this.do_perform_action("votes_up")},setting_ai_mode:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.update_setting({field:"write_mode",value:e}),t.$store.commit("setUser",{write_mode:Object.assign({},t.user.email_ai_setting,{write_mode:e})});case 2:case"end":return a.stop()}}),a)})))()}},computed:{is_votes_up:function(){var e=this.current_template||{},t=e.UserVotesUp;return!!Array.isArray(t)&&t.length>0},is_starred:function(){var e=this.current_template||{},t=e.UserStar;return!!Array.isArray(t)&&t.length>0}}},X=D,q=(a("ad9c"),Object(b["a"])(X,u,_,!1,null,null,null)),N=q.exports,Y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-card",{staticClass:"custom-email-card preview-card",attrs:{"no-body":""}},[a("div",{staticClass:"custom-email-card-row border-bottom d-flex"},[a("div",{staticClass:"font-weight-bold"},[e._v("Preview email")])]),a("div",{staticClass:"custom-email-card-row d-flex align-items-center justify-content-between border-bottom",staticStyle:{padding:"0.8rem 0"}},[a("div",{staticClass:"mr-2"},[e._v("To")]),a("editable-text",{staticStyle:{flex:"1",display:"grid"},attrs:{text_cls:"text-truncate",placeholder:e.$t("placeholder.ai.mail_to"),text:e.mail_to},on:{on_change:e.on_mail_to_change}}),e.is_finding?a("div",{staticClass:"d-flex align-items-center finding-email-status"},[a("span",{staticClass:"finding-email-icon mr-1"}),e._v(" Finding email... ")]):e._e(),a("copy-btn",{staticClass:"mr-2",attrs:{disable:!e.mail_to,text:e.mail_to},on:{"update:text":function(t){e.mail_to=t}}})],1),a("div",{staticClass:"custom-email-card-row d-flex justify-content-between border-bottom",staticStyle:{padding:"0.8rem 0"}},[a("editable-text",{staticStyle:{flex:"1",display:"grid"},attrs:{is_html:"",text_cls:"text-truncate",placeholder:e.$t("placeholder.ai.generate_subject"),text:e.current_preview_email.subject},on:{on_change:e.on_email_subject_change}}),a("copy-btn",{staticClass:"mr-2",attrs:{disable:!e.current_preview_email.subject,text:e.current_preview_email.subject},on:{"update:text":function(t){return e.$set(e.current_preview_email,"subject",t)}}})],1),a("div",{staticClass:"custom-email-card-row pt-0 border-bottom-0"},[a("div",{staticClass:"mt-3"},[e.is_content_edit_mode?a("b-form-textarea",{ref:"edit_content",staticClass:"main-ops-view template-content-edit",attrs:{autocomplete:"off",rows:"5"},on:{blur:e.on_blur,change:e.on_email_content_change},model:{value:e.current_preview_email.content,callback:function(t){e.$set(e.current_preview_email,"content","string"===typeof t?t.trim():t)},expression:"current_preview_email.content"}}):a("div",{staticClass:"main-ops-view template-content",class:{"text-mute":!e.current_preview_email.content},domProps:{innerHTML:e._s(e.email_content)},on:{click:function(t){e.is_content_edit_mode=!0}}})],1)]),a("div",{staticClass:"d-md-flex justify-content-between align-items-center bottom-tool-bar"},[a("div",{staticClass:"mb-2 mb-md-0 mr-2"},[a("b-button-group",[a("promise-btn",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:e.$t("tooltip.ai.regenerate_professional"),disabled:e.is_ai_writing,cls:"text-truncate border-right-0",is_spinner_first:"",text:"Professional",params:"professional",variant:"outline-primary",on_click:e.revise_ai_write_email},on:{"update:disabled":function(t){e.is_ai_writing=t}}}),a("promise-btn",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:e.$t("tooltip.ai.regenerate_casual"),disabled:e.is_ai_writing,cls:"text-truncate border-right-0",is_spinner_first:"",text:"Casual",params:"casual",variant:"outline-primary",on_click:e.revise_ai_write_email},on:{"update:disabled":function(t){e.is_ai_writing=t}}}),a("promise-btn",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:e.$t("tooltip.ai.regenerate_friendly"),disabled:e.is_ai_writing,cls:"text-truncate border-right-0",is_spinner_first:"",text:"Friendly",params:"friendly",variant:"outline-primary",on_click:e.revise_ai_write_email},on:{"update:disabled":function(t){e.is_ai_writing=t}}}),a("promise-btn",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:e.$t("tooltip.ai.regenerate_shorter"),disabled:e.is_ai_writing,cls:"text-truncate",is_spinner_first:"",text:"Short",params:"shorter",variant:"outline-primary",on_click:e.revise_ai_write_email},on:{"update:disabled":function(t){e.is_ai_writing=t}}})],1)],1),a("div",{staticClass:"d-flex mb-2 mb-md-0 mr-2"},[a("span",{ref:"suggestion_btn",staticClass:"cursor-pointer mr-3",class:{"d-none":!e.current_preview_email.suggestion}},[a("i",{staticClass:"flaticon-feedback"})]),a("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mr-2",class:{"text-mute":!e.enable_prev,"cursor-pointer":e.enable_prev},attrs:{title:e.$t("tooltip.ai.prev_preview_email")},on:{click:e.prev_email}},[a("i",{staticClass:"flaticon-left-arrow"})]),a("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mr-2",class:{"text-mute":!e.enable_next,"cursor-pointer":e.enable_next},attrs:{title:e.$t("tooltip.ai.next_preview_email")},on:{click:e.next_email}},[a("i",{staticClass:"flaticon-right-arrow"})]),a("copy-btn",{attrs:{disable:!e.current_preview_email.content,text:e.current_preview_email.content},on:{"update:text":function(t){return e.$set(e.current_preview_email,"content",t)}}}),e.user.is_superuser&&e.current_preview_email.id?a("a",{staticClass:"text-link ml-2",attrs:{href:"/admin/devops/logs?track_id="+e.current_preview_email.id,target:"_blank"}},[e._v("Logs")]):e._e()],1),a("div",{staticClass:"mb-2 mb-md-0"},[a("b-dropdown",{staticClass:"plugin-btn text-truncate",attrs:{split:"",variant:"primary",boundary:"window","split-class":"border-right","toggle-class":"toggle-btn border-left"},on:{click:e.create_link}},[a("template",{slot:"button-content"},[e.current_preview_email.latest_sent_at?a("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:e.email_sent_tooltip}},[a("b-badge",{staticClass:"badge-dot mr-1",attrs:{pill:"",variant:"success"}},[e._v("Â ")]),e._v(" Send Now ")],1):a("span",[e._v("Send Now")])]),a("b-alert",{staticClass:"rounded-0",attrs:{show:"",variant:"secondary"}},[a("i",{staticClass:"flaticon-info mr-2"}),e._v("Use a desktop mail client (Outlook, Apple Mail, etc.) for 10x faster experience ")]),a("b-dropdown-item",{attrs:{active:e.mail_app===e.MailAppTypes.SYSTEM},on:{click:function(t){return e.setting_mail_app(e.MailAppTypes.SYSTEM)}}},[e._v("Always use system default mail app")]),a("b-dropdown-item",{attrs:{active:e.mail_app===e.MailAppTypes.GMAIL},on:{click:function(t){return e.setting_mail_app(e.MailAppTypes.GMAIL)}}},[e._v("Always use Gmail")]),a("b-dropdown-item",{attrs:{active:e.mail_app===e.MailAppTypes.OUTLOOK},on:{click:function(t){return e.setting_mail_app(e.MailAppTypes.OUTLOOK)}}},[e._v("Always use Outlook (outlook.live.com)")]),a("b-dropdown-item",{attrs:{active:e.mail_app===e.MailAppTypes.YAHOO},on:{click:function(t){return e.setting_mail_app(e.MailAppTypes.YAHOO)}}},[e._v("Always use Yahoo mail")])],2)],1)]),a("div",[a("b-tooltip",{attrs:{target:function(){return e.$refs["suggestion_btn"]},triggers:"hover",boundary:"window","custom-class":"custom-tooltip"}},[e._v(" "+e._s(this.current_preview_email.suggestion)+" "),a("div",{staticClass:"d-flex justify-content-center mt-3"},[a("promise-btn",{staticClass:"plugin-btn",attrs:{size:"sm",disabled:e.is_ai_writing,cls:"text-truncate",text:"Revise the email based on the suggestion",params:"improve_by_suggestion",variant:"primary",on_click:e.revise_ai_write_email}})],1)])],1)])},G=[],Q=(a("c740"),a("c1df")),V={components:{Template:R["a"]},mixins:[z],props:{},watch:{"emailAI.contact_email_ai.current_preview_email":{handler:function(){var e=this.history_emails.length;if(e<=1)return this.enable_prev=!1,void(this.enable_next=!1);var t=this.current_preview_email_index;this.enable_prev=t>0,this.enable_next=t<e-1},immediate:!0}},data:function(){return{input_mail_to:"",enable_prev:!1,enable_next:!1,is_content_edit_mode:!1}},updated:function(){var e=this.$refs["edit_content"];e&&e.$el.focus()},methods:{revise_ai_write_email:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,r,n,s,o,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=t.current_preview_email,r=i.subject,n=i.content,s=i.language,o=i.suggestion,l={type:e,source_content:n,source_subject:r,source_language:s,source_suggestion:o},a.next=4,t.do_start_ai_write_email(l);case 4:case"end":return a.stop()}}),a)})))()},on_mail_to_change:function(e){var t=e.value;this.input_mail_to=t},on_current_preview_email_change:function(e){var t=Object.assign({},this.current_preview_email,e||{}),a=this.current_preview_email_index,i=this.history_emails;a>=0&&a<i.length&&(i[a]=t),Object.assign(this.emailAI.contact_email_ai,{current_preview_email:t})},on_email_subject_change:function(e){var t=e.value;this.on_current_preview_email_change({subject:t})},setting_mail_app:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.update_setting({field:"mail_app",value:e}),t.$store.commit("setUser",{email_ai_setting:Object.assign({},t.user.email_ai_setting,{mail_app:e})});case 2:case"end":return a.stop()}}),a)})))()},create_link:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,i,r,n,s,o,l,c,m,u,_,d,p,A,f,g,v,b;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.mail_app,i=e.current_preview_email,r=i.subject,n=i.content,s=i.id,o=i.template_id,l=e.mail_to,a===e.MailAppTypes.GMAIL?(c="https://mail.google.com/mail/?view=cm&fs=1&to=".concat(encodeURIComponent(l),"&su=").concat(encodeURIComponent(r),"&body=").concat(encodeURIComponent(n)),window.open(c,"_blank").focus()):a===e.MailAppTypes.OUTLOOK?(m="mailto:".concat(encodeURIComponent(l),"?subject=").concat(encodeURIComponent(r),"&body=").concat(encodeURIComponent(n)),u="https://outlook.live.com/mail/0/deeplink/compose?mailtouri=".concat(encodeURIComponent(m)),window.open(u,"_blank").focus()):a===e.MailAppTypes.YAHOO?(_="https://compose.mail.yahoo.com/?to=".concat(encodeURIComponent(l),"&subj=").concat(encodeURIComponent(r),"&body=").concat(encodeURIComponent(n)),window.open(_,"_blank").focus()):(d="mailto:".concat(l,"?subject=").concat(encodeURIComponent(r),"&body=").concat(encodeURIComponent(n)),window.open(d)),p={email_id:s,template_id:o,contact_id:e.contact.id,action:"send"},e.$bvModal.hide("email_ai_modal"),t.next=8,e.$api.req({url:"/api/email-ai/email/action",method:"POST",data:p},!0,!0);case 8:A=t.sent,f=A.ok,g=A.result,!0===f&&(v=g.sent_at,b=g.email_id,e.on_current_preview_email_change({latest_sent_at:v}),e.$globalEvent.$emit("GlobalEvent:EmailAI:email:sent",{contact_id:e.contact.id,sent_at:v,email_id:b}));case 12:case"end":return t.stop()}}),t)})))()},on_blur:function(){this.is_content_edit_mode=!1},on_email_content_change:function(){this.on_current_preview_email_change({})},prev_email:function(){if(this.enable_prev){var e=this.current_preview_email_index,t=this.history_emails;if(!(e<0||e>=t.length)){var a=t[e-1];Object.assign(this.emailAI.contact_email_ai,{current_preview_email:a})}}},next_email:function(){if(this.enable_next){var e=this.current_preview_email_index,t=this.history_emails;if(!(e<0||e>=t.length)){var a=t[e+1];Object.assign(this.emailAI.contact_email_ai,{current_preview_email:a})}}}},computed:{current_preview_email_index:function(){var e=this.current_preview_email;return this.history_emails.findIndex((function(t){return t.id===e.id}))},email_sent_tooltip:function(){var e=this.current_preview_email.latest_sent_at;return e?"It appears you sent a message to this contact at ".concat(Q(e).format("MMM D HH:mm:ss")):""},email_content:function(){return this.current_preview_email.content?this.current_preview_email.content:'Email body (Click "Write a new email" to get started)'},is_finding:function(){return!0===this.contact.is_finding},mail_to:function(){if(""!==this.input_mail_to.trim())return this.input_mail_to;var e=this.contact||{},t=e.full_name,a=e.email;return a?t?"".concat(t.replace(/[,]/g," "),"<").concat(a,">"):a:""}}},H=V,Z=(a("414c"),Object(b["a"])(H,Y,G,!1,null,null,null)),W=Z.exports,J={components:{Setting:N,Preview:W},props:{},data:function(){return{}},methods:{},computed:{}},K=J,ee=(a("11ee"),Object(b["a"])(K,c,m,!1,null,null,null)),te=ee.exports,ae=a("0db1"),ie=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"mt-2 text-center"},[e._v("The merge fields can be used to create and customize the email writing instruction templates.")]),a("div",{staticClass:"mt-2"},[a("b-button",{staticClass:"plugin-btn",attrs:{size:"sm",variant:"outline-primary"},on:{click:e.new_merge_field}},[a("span",{staticClass:"mr-2"},[e._v("+")]),e._v("New merge field ")])],1),a("vue-good-table",{staticClass:"no-shadow mt-3 mb-4",attrs:{columns:e.columns,"pagination-options":{enabled:!1},styleClass:"tableOne vgt-table","select-options":{enabled:!1},rows:e.merge_fields},scopedSlots:e._u([{key:"table-row",fn:function(t){return["merge_key_var"===t.column.field?a("span",[t.row.is_system?a("span",[e._v(" "+e._s(t.row.merge_key_var)+" ")]):a("span",[t.row.is_edit_mode?a("div",{staticClass:"input-group"},[a("div",{staticClass:"input-group-prepend"},[a("span",{staticClass:"input-group-text"},[e._v("{{")])]),a("b-form-input",{ref:"merge_key_"+t.index,attrs:{maxlength:"48"},model:{value:t.row.merge_key,callback:function(a){e.$set(t.row,"merge_key","string"===typeof a?a.trim():a)},expression:"props.row.merge_key"}}),a("div",{staticClass:"input-group-append"},[a("span",{staticClass:"input-group-text"},[e._v("}}")])])],1):a("span",[e._v(e._s(t.row.merge_key_var))])])]):e._e(),"merge_value"===t.column.field?a("span",[t.row.is_edit_mode?a("span",["my_selling_points"===t.row.merge_key||"my_product_or_service_offered"===t.row.merge_key?a("b-form-textarea",{ref:"merge_value_"+t.index,attrs:{rows:"3"},model:{value:t.row.merge_value,callback:function(a){e.$set(t.row,"merge_value","string"===typeof a?a.trim():a)},expression:"props.row.merge_value"}}):a("b-form-input",{ref:"merge_value_"+t.index,model:{value:t.row.merge_value,callback:function(a){e.$set(t.row,"merge_value","string"===typeof a?a.trim():a)},expression:"props.row.merge_value"}})],1):a("span",[e._v(e._s(t.row.merge_value))])]):e._e(),"action"===t.column.field?a("span",[t.row.is_system?[t.row.is_edit_mode?a("promise-btn",{attrs:{cls:"plugin-btn",size:"sm",params:{merge_field:t.row,index:t.index},variant:"outline-primary",on_click:e.do_apply_edit}},[a("template",{slot:"content"},[a("i",{staticClass:"flaticon-checkmark"}),e._v(" Save ")])],2):a("b-button",{staticClass:"plugin-btn",attrs:{size:"sm",variant:"outline-primary"},on:{click:function(a){return e.edit_merge_field(t.row,t.index)}}},[a("i",{staticClass:"flaticon-edit"}),e._v(" Edit ")])]:[t.row.is_edit_mode?a("promise-btn",{attrs:{cls:"plugin-btn",size:"sm",params:{merge_field:t.row,index:t.index},variant:"outline-primary",on_click:e.do_apply_edit}},[a("template",{slot:"content"},[a("i",{staticClass:"flaticon-checkmark"}),e._v(" Save ")])],2):a("b-button",{staticClass:"plugin-btn",attrs:{size:"sm",variant:"outline-primary"},on:{click:function(a){return e.edit_merge_field(t.row,t.index)}}},[a("i",{staticClass:"flaticon-edit"}),e._v(" Edit ")]),t.row.id?a("promise-btn",{attrs:{cls:"plugin-btn ml-2",size:"sm",params:{merge_field:t.row,index:t.index},variant:"outline-danger",on_click:e.delete_merge_field}},[a("template",{slot:"content"},[a("i",{staticClass:"flaticon-delete"}),e._v(" Delete ")])],2):e._e()]],2):e._e()]}}])})],1)},re=[],ne=(a("fb6a"),a("4de4"),{props:{},data:function(){return{merge_fields:[],columns:[{label:"Merge field name",field:"merge_key_var",tdClass:"align-middle",width:"200px",sortable:!1},{label:"Merge field value",field:"merge_value",tdClass:"align-middle",sortable:!1},{label:"Actions",field:"action",width:"180px",sortable:!1,html:!0,tdClass:"align-middle text-right",thClass:"text-right"}]}},created:function(){var e=this.emailAI,t=e.merge_fields,a=e.manage_merge_fields_params;t=Array.isArray(t)?t.slice():[];var i=a||{},r=i.new_merge_fields;r=Array.isArray(r)?r:[],this.merge_fields=t.concat(r)},methods:{new_merge_field:function(){this.merge_fields.push({is_system:!1,merge_key:"",merge_value:"",is_edit_mode:!0})},edit_merge_field:function(e,t){Object.assign(e,{is_edit_mode:!0}),this.$set(this.merge_fields,t,e)},do_apply_edit:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,r,n,s,o,l,c,m;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=e.merge_field,r=e.index,""!==(i.merge_key||"").trim()){a.next=4;break}return t.$refs["merge_key_".concat(r)].$el.focus(),a.abrupt("return");case 4:if(""!==(i.merge_value||"").trim()){a.next=7;break}return t.$refs["merge_value_".concat(r)].$el.focus(),a.abrupt("return");case 7:return a.prev=7,n=[i],a.next=11,t.$api.req({url:"/api/email-ai/merge_field",method:"POST",data:n},!0);case 11:if(s=a.sent,o=s.success,l=s.invalid_fields,c=s.merge_fields,m=s.saved_merge_fields,!o){a.next=21;break}Object.assign(i,m[0],{is_edit_mode:!1}),t.$store.commit("updateEmailAIState",{merge_fields:c}),a.next=26;break;case 21:if(!l.error){a.next=24;break}return a.next=24,t.$utils.showMessage(l.error,"error");case 24:l.merge_value&&t.$refs["merge_value_".concat(r)].$el.focus(),l.merge_key&&t.$refs["merge_key_".concat(r)].$el.focus();case 26:a.next=30;break;case 28:a.prev=28,a.t0=a["catch"](7);case 30:case"end":return a.stop()}}),a,null,[[7,28]])})))()},delete_merge_field:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,r,n,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=e.merge_field,e.index,a.next=3,t.$utils.confirm({html:'Are you sure want to delete the merge field [<span class="font-weight-bold">'.concat(i.merge_key,"</span>]?"),confirmButtonText:"Yes, delete it!"},{confirmButton:"btn btn-danger"});case 3:if(r=a.sent,r){a.next=6;break}return a.abrupt("return");case 6:return a.prev=6,a.next=9,t.$api.req({url:"/api/email-ai/merge_field",method:"DELETE",data:{id:i.id}},!0);case 9:n=a.sent,s=n.merge_fields,t.$store.commit("updateEmailAIState",{merge_fields:s}),t.merge_fields=t.merge_fields.filter((function(e){return e.id!==i.id})),a.next=17;break;case 15:a.prev=15,a.t0=a["catch"](6);case 17:case"end":return a.stop()}}),a,null,[[6,15]])})))()}},computed:Object(n["a"])({},Object(o["d"])({emailAI:function(e){return e.emailAI}}))}),se=ne,oe=(a("4aa0"),Object(b["a"])(se,ie,re,!1,null,null,null)),le=oe.exports,ce={is_ready:!1,is_writing:!1,is_background:!1,is_success_written:!0,contact:{},current_template:{},current_preview_email:{subject:"",content:"",tpl_id:""},emails:[],progress_percent:0,load_contact:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,r,n,s,o,l,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=e.contact_id,r=e.li_cookies,a.prev=1,n={contact_id:i,li_cookies:r},a.next=5,window.root.$api.req({url:"/api/email-ai/contact",method:"POST",data:n},!0);case 5:s=a.sent,o=s.contact,l=s.current_template,c=s.emails,t.contact=o,t.current_template=l,t.emails=c,c.length&&(t.current_preview_email=t.emails[t.emails.length-1]),window.root.$store.commit("addContactEmailAI",{contact_id:i,contact_email_ai:t}),t.is_ready=!0,!0===o.is_finding&&t.poll_find_result(),a.next=20;break;case 18:a.prev=18,a.t0=a["catch"](1);case 20:case"end":return a.stop()}}),a,null,[[1,18]])})))()},poll_find_result:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,i,r,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=e.contact.id,i=1;case 2:if(!(i<=20)){t.next=22;break}return t.next=5,window.root.$utils.sleep(5e3);case 5:return t.prev=5,t.next=8,window.root.$api.req({url:"/api/email-ai/find/email/status",method:"GET",params:{contact_id:a}},!0,!0);case 8:if(r=t.sent,n=r.is_finding,s=r.email,!0===n){t.next=14;break}return Object.assign(e.contact,{email:s,is_finding:!1}),t.abrupt("break",22);case 14:t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](5),console.error("poll_find_result error",t.t0);case 19:i++,t.next=2;break;case 22:Object.assign(e.contact,{is_finding:!1});case 23:case"end":return t.stop()}}),t,null,[[5,16]])})))()},ai_write_email:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,r,n,s,o,l,c,m,u,_,d,p,A,f,g,v,b,h,w,y,k;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=e.request_data,r=t.current_template,n=t.contact.id,Object.assign(i,{contact_id:n,template_id:r.id}),s=i.type,o=i.source_content,l=i.template_content,o||l){a.next=8;break}return console.error("Content is required."),a.abrupt("return");case 8:return t.is_success_written=!0,t.progress_percent=0,t.is_writing=!0,c=window.root,m=c.$utils.AI_Contact_Status,c.$globalEvent.$emit("GlobalEvent:EmailAI:writing_status",{contact_id:n,status:m.WRITING}),a.prev=14,t.progress_trickle(),a.next=18,window.root.$api.req({url:"/api/email-ai/write_email",method:"POST",data:i,timeout:6e4},!0,!0);case 18:u=a.sent,_=u.id,d=u.subject,p=u.ai_subject,A=u.content,f=u.language,g=u.suggestion,v=u.tone,b=u.template,h={id:_,subject:d,ai_subject:p,content:A,language:f,suggestion:g,tone:v,type:s,tpl_id:r.id},b&&Object.assign(t.current_template,b),A?(t.current_preview_email=h,t.emails.push(h),c.$globalEvent.$emit("GlobalEvent:EmailAI:writing_status",{contact_id:n,status:m.COMPLETED,email_id:_})):(t.is_success_written=!1,c.$globalEvent.$emit("GlobalEvent:EmailAI:writing_status",{contact_id:n,status:m.FAILED})),a.next=38;break;case 32:a.prev=32,a.t0=a["catch"](14),t.is_success_written=!1,c.$globalEvent.$emit("GlobalEvent:EmailAI:writing_status",{contact_id:n,status:m.FAILED}),console.error("ai_write_email error---\x3e",a.t0),t.is_background||(w=a.t0.status,y=a.t0.message,k=a.t0.error_shown,k||504!==w&&c.$utils.showMessage(y||window.root.$t("error.failed_request"),"error"));case 38:t.is_writing=!1;case 39:case"end":return a.stop()}}),a,null,[[14,32]])})))()},set_current_preview_email:function(e){var t=this.emails.find((function(t){return t.id===e}));return!!t&&(this.current_preview_email=t,!0)},progress_trickle:function(){var e=this;setTimeout((function(){e.is_writing?(e.progress_percent=Math.min(95,e.progress_percent+18),e.progress_trickle()):e.progress_percent=0}),1e3)}},me={props:{options:{},li_cookies:""},components:{Initialization:l["a"],CustomEmail:te,Templates:ae["a"],ManageMergeFields:le},watch:{"emailAI.initialize_finished":{handler:function(){this.emailAI.initialize_finished?this.on_initialize_finished():this.$store.commit("updateEmailAIState",{state:"initialize"})},immediate:!0},options:{handler:function(){this.init_email_ai()},immediate:!0,deep:!0}},data:function(){return{loading:!0}},created:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$store.commit("updateEmailAIState",{state:"custom"});case 1:case"end":return t.stop()}}),t)})))()},methods:{back_custom:function(){this.$store.commit("updateEmailAIState",{state:"custom"})},init_email_ai:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,i,r,n,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.options||{},i=a.contact_id,r=a.preview_email_id,n=a.contact_email_ai,!n&&i&&(n=e.contact_email_ai_list.find((function(e){return"".concat(e.contact.id)==="".concat(i)}))),n&&(i="".concat(n.contact.id),r&&(s=n.set_current_preview_email(r),s||(n=null))),n||i){t.next=6;break}return console.error("No contact, invalid data=> ignore",e.options),t.abrupt("return");case 6:if(n){t.next=11;break}return n=Object.assign({},ce),t.next=10,n.load_contact({contact_id:i,li_cookies:e.li_cookies});case 10:r&&n.set_current_preview_email(r);case 11:if(e.$store.commit("updateEmailAIState",{contact_email_ai:n}),e.emailAI.initialize_finished){t.next=25;break}return t.prev=13,t.next=16,e.$api.req({url:"/api/email-ai/email/initialization",method:"GET"},!0);case 16:o=t.sent,e.$store.commit("updateEmailAIState",o),t.next=22;break;case 20:t.prev=20,t.t0=t["catch"](13);case 22:e.emailAI.initialize_finished||e.$store.commit("updateEmailAIState",{state:"initialize"}),t.next=26;break;case 25:e.on_initialize_finished();case 26:e.loading=!1;case 27:case"end":return t.stop()}}),t,null,[[13,20]])})))()},run_background:function(){this.config.is_plugin_app||(this.$store.commit("addToBackground",{}),this.$bvModal.hide("email_ai_modal"))},on_initialize_finished:function(){var e=this.emailAI.contact_email_ai.current_template;e&&e.id?this.$store.commit("updateEmailAIState",{state:"custom"}):this.$store.commit("updateEmailAIState",{state:"templates_private"})}},computed:Object(n["a"])(Object(n["a"])({},Object(o["d"])({user:function(e){return e.global.user},config:function(e){return e.global.config},emailAI:function(e){return e.emailAI}})),{},{contact_email_ai_list:function(){return this.emailAI.contact_email_ai_list||[]},progress_percent:function(){return this.emailAI.contact_email_ai.progress_percent||0},is_writing:function(){return!this.loading&&this.emailAI.contact_email_ai.is_writing},is_templates_list:function(){var e=this.emailAI.state;return["templates_private","templates_public"].includes(e)}})},ue=me,_e=(a("4ee3"),Object(b["a"])(ue,i,r,!1,null,null,null));t["default"]=_e.exports},"8cbf":function(e,t){e.exports="data:image/png;base64,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"},ad9c:function(e,t,a){"use strict";a("5444")},ade3:function(e,t,a){"use strict";function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,"a",(function(){return i}))},dbb4:function(e,t,a){var i=a("23e7"),r=a("83ab"),n=a("56ef"),s=a("fc6a"),o=a("06cf"),l=a("8418");i({target:"Object",stat:!0,sham:!r},{getOwnPropertyDescriptors:function(e){var t,a,i=s(e),r=o.f,c=n(i),m={},u=0;while(c.length>u)a=r(i,t=c[u++]),void 0!==a&&l(m,t,a);return m}})},e439:function(e,t,a){var i=a("23e7"),r=a("d039"),n=a("fc6a"),s=a("06cf").f,o=a("83ab"),l=r((function(){s(1)})),c=!o||l;i({target:"Object",stat:!0,forced:c,sham:!o},{getOwnPropertyDescriptor:function(e,t){return s(n(e),t)}})},e6d6:function(e,t,a){},e762:function(e,t,a){"use strict";a.r(t),a.d(t,"version",(function(){return i})),a.d(t,"VERSION",(function(){return r})),a.d(t,"atob",(function(){return T})),a.d(t,"atobPolyfill",(function(){return S})),a.d(t,"btoa",(function(){return b})),a.d(t,"btoaPolyfill",(function(){return v})),a.d(t,"fromBase64",(function(){return P})),a.d(t,"toBase64",(function(){return O})),a.d(t,"utob",(function(){return x})),a.d(t,"encode",(function(){return O})),a.d(t,"encodeURI",(function(){return j})),a.d(t,"encodeURL",(function(){return j})),a.d(t,"btou",(function(){return R})),a.d(t,"decode",(function(){return P})),a.d(t,"isValid",(function(){return F})),a.d(t,"fromUint8Array",(function(){return w})),a.d(t,"toUint8Array",(function(){return $})),a.d(t,"extendString",(function(){return z})),a.d(t,"extendUint8Array",(function(){return D})),a.d(t,"extendBuiltins",(function(){return X})),a.d(t,"Base64",(function(){return q}));const i="3.7.2",r=i,n="function"===typeof atob,s="function"===typeof btoa,o="function"===typeof Buffer,l="function"===typeof TextDecoder?new TextDecoder:void 0,c="function"===typeof TextEncoder?new TextEncoder:void 0,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=Array.prototype.slice.call(m),_=(e=>{let t={};return e.forEach((e,a)=>t[e]=a),t})(u),d=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,p=String.fromCharCode.bind(String),A="function"===typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):(e,t=(e=>e))=>new Uint8Array(Array.prototype.slice.call(e,0).map(t)),f=e=>e.replace(/=/g,"").replace(/[+\/]/g,e=>"+"==e?"-":"_"),g=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),v=e=>{let t,a,i,r,n="";const s=e.length%3;for(let o=0;o<e.length;){if((a=e.charCodeAt(o++))>255||(i=e.charCodeAt(o++))>255||(r=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");t=a<<16|i<<8|r,n+=u[t>>18&63]+u[t>>12&63]+u[t>>6&63]+u[63&t]}return s?n.slice(0,s-3)+"===".substring(s):n},b=s?e=>btoa(e):o?e=>Buffer.from(e,"binary").toString("base64"):v,h=o?e=>Buffer.from(e).toString("base64"):e=>{const t=4096;let a=[];for(let i=0,r=e.length;i<r;i+=t)a.push(p.apply(null,e.subarray(i,i+t)));return b(a.join(""))},w=(e,t=!1)=>t?f(h(e)):h(e),y=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?p(192|t>>>6)+p(128|63&t):p(224|t>>>12&15)+p(128|t>>>6&63)+p(128|63&t)}t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return p(240|t>>>18&7)+p(128|t>>>12&63)+p(128|t>>>6&63)+p(128|63&t)},k=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,x=e=>e.replace(k,y),C=o?e=>Buffer.from(e,"utf8").toString("base64"):c?e=>h(c.encode(e)):e=>b(x(e)),O=(e,t=!1)=>t?f(C(e)):C(e),j=e=>O(e,!0),E=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,I=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),a=t-65536;return p(55296+(a>>>10))+p(56320+(1023&a));case 3:return p((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return p((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},R=e=>e.replace(E,I),S=e=>{if(e=e.replace(/\s+/g,""),!d.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,a,i,r="";for(let n=0;n<e.length;)t=_[e.charAt(n++)]<<18|_[e.charAt(n++)]<<12|(a=_[e.charAt(n++)])<<6|(i=_[e.charAt(n++)]),r+=64===a?p(t>>16&255):64===i?p(t>>16&255,t>>8&255):p(t>>16&255,t>>8&255,255&t);return r},T=n?e=>atob(g(e)):o?e=>Buffer.from(e,"base64").toString("binary"):S,M=o?e=>A(Buffer.from(e,"base64")):e=>A(T(e),e=>e.charCodeAt(0)),$=e=>M(B(e)),U=o?e=>Buffer.from(e,"base64").toString("utf8"):l?e=>l.decode(M(e)):e=>R(T(e)),B=e=>g(e.replace(/[-_]/g,e=>"-"==e?"+":"/")),P=e=>U(B(e)),F=e=>{if("string"!==typeof e)return!1;const t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},L=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),z=function(){const e=(e,t)=>Object.defineProperty(String.prototype,e,L(t));e("fromBase64",(function(){return P(this)})),e("toBase64",(function(e){return O(this,e)})),e("toBase64URI",(function(){return O(this,!0)})),e("toBase64URL",(function(){return O(this,!0)})),e("toUint8Array",(function(){return $(this)}))},D=function(){const e=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,L(t));e("toBase64",(function(e){return w(this,e)})),e("toBase64URI",(function(){return w(this,!0)})),e("toBase64URL",(function(){return w(this,!0)}))},X=()=>{z(),D()},q={version:i,VERSION:r,atob:T,atobPolyfill:S,btoa:b,btoaPolyfill:v,fromBase64:P,toBase64:O,encode:O,encodeURI:j,encodeURL:j,utob:x,btou:R,decode:P,isValid:F,fromUint8Array:w,toUint8Array:$,extendString:z,extendUint8Array:D,extendBuiltins:X}},ed95:function(e,t,a){"use strict";a("e6d6")},f603:function(e,t,a){}}]);